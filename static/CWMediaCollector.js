!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";function $t(e){return($t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function t(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function U(o){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?t(Object(n),!0).forEach(function(e){var t,r;t=o,e=n[r=e],r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(n,e))})}return o}var e,r;e=void 0,r=function(){r=void 0,e=function(e){var t="function"==typeof Symbol&&"symbol"==$t(Symbol.iterator)?Symbol:function(e){return"Symbol("+e+")"},r="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0,o=Number.isNaN||function(e){return e!=e};function n(e){return"object"==$t(e)&&null!==e||"function"==typeof e}function i(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function m(e){return e.slice()}function a(e){return 0!=("number"==typeof(t=e)&&!o(t)&&!(t<0))&&e!==1/0;var t}function s(e,t,r){if("function"!=typeof e)throw new TypeError("Argument is not a function");return Function.prototype.apply.call(e,t,r)}function l(t,e,r,o){var n=t[e];if(void 0!==n){if("function"!=typeof n)throw new TypeError(n+" is not a method");switch(r){case 0:return function(){return h(n,t,o)};case 1:return function(e){return e=[e].concat(o),h(n,t,e)}}}return function(){return Promise.resolve()}}function f(e,t,r){if(void 0!==(t=e[t]))return s(t,e,r)}function h(e,t,r){try{return Promise.resolve(s(e,t,r))}catch(e){return Promise.reject(e)}}function p(e){if(e=Number(e),o(e)||e<0)throw new RangeError("highWaterMark property of a queuing strategy must be non-negative and non-NaN");return e}function g(t){if(void 0===t)return function(){return 1};if("function"!=typeof t)throw new TypeError("size property of a queuing strategy must be a function");return function(e){return t(e)}}function _(e,r,t){for(var o=!1,n=function(e){!1===o&&(o=!0,t(e))},i=0,a=0,s=e.length,d=new Array(s),c=0,u=e;c<u.length;c++)!function(e){var t=i;Promise.prototype.then.call(e,function(e){d[t]=e,++a===s&&r(d)},n),++i}(u[c])}var R=function(){};function d(e){var t=e._queue.shift();return e._queueTotalSize-=t.size,e._queueTotalSize<0&&(e._queueTotalSize=0),t.value}function c(e,t,r){if(!a(r=Number(r)))throw new RangeError("Size must be a finite, non-NaN, non-negative number.");e._queue.push({value:t,size:r}),e._queueTotalSize+=r}function u(e){e._queue=[],e._queueTotalSize=0}var b=t("[[AbortSteps]]"),v=t("[[ErrorSteps]]"),y=(Object.defineProperty(w.prototype,"locked",{get:function(){if(!1===C(this))throw K("locked");return k(this)},enumerable:!0,configurable:!0}),w.prototype.abort=function(e){return!1===C(this)?Promise.reject(K("abort")):!0===k(this)?Promise.reject(new TypeError("Cannot abort a stream that already has a writer")):P(this,e)},w.prototype.getWriter=function(){if(!1===C(this))throw K("getWriter");return S(this)},w);function w(e,t){void 0===e&&(e={}),void 0===t&&(t={}),T(this);var r=t.size,o=t.highWaterMark;if(void 0!==e.type)throw new RangeError("Invalid type is specified");var n,i=g(r),a=e;t=o=p(o=void 0===o?1:o),r=i,n=Object.create(F.prototype),e=l(a,"write",1,[n]),o=l(a,"close",0,[]),i=l(a,"abort",1,[]),N(this,n,function(){return f(a,"start",[n])},e,o,i,t,r)}function S(e){return new B(e)}function T(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=[],e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function C(e){return!!n(e)&&!!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")}function k(e){return void 0!==e._writer}function P(r,o){var e=r._state;if("closed"===e||"errored"===e)return Promise.resolve(void 0);if(void 0!==r._pendingAbortRequest)return r._pendingAbortRequest._promise;var n=!1;return"erroring"===e&&(n=!0,o=void 0),e=new Promise(function(e,t){r._pendingAbortRequest={_promise:void 0,_resolve:e,_reject:t,_reason:o,_wasAlreadyErroring:n}}),r._pendingAbortRequest._promise=e,!1===n&&A(r,o),e}function E(e,t){"writable"!==e._state?j(e):A(e,t)}function A(e,t){var r=e._writableStreamController;e._state="erroring",e._storedError=t;var o=e._writer;void 0!==o&&x(o,t),0==(void 0!==e._inFlightWriteRequest||void 0!==e._inFlightCloseRequest)&&!0===r._started&&j(e)}function j(t){t._state="errored",t._writableStreamController[v]();for(var e=t._storedError,r=0,o=t._writeRequests;r<o.length;r++)o[r]._reject(e);if(t._writeRequests=[],void 0!==t._pendingAbortRequest){var n=t._pendingAbortRequest;if(!(t._pendingAbortRequest=void 0)===n._wasAlreadyErroring)return n._reject(e),M(t),0;t._writableStreamController[b](n._reason).then(function(){n._resolve(),M(t)},function(e){n._reject(e),M(t)})}else M(t)}function O(e){return void 0!==e._closeRequest||void 0!==e._inFlightCloseRequest}function M(e){void 0!==e._closeRequest&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);var t=e._writer;void 0!==t&&te(t,e._storedError)}function L(e,t){var r=e._writer;void 0!==r&&t!==e._backpressure&&(!0===t?oe:se)(r),e._backpressure=t}var B=(Object.defineProperty(q.prototype,"closed",{get:function(){return!1===I(this)?Promise.reject($("closed")):this._closedPromise},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"desiredSize",{get:function(){if(!1===I(this))throw $("desiredSize");if(void 0===this._ownerWritableStream)throw X("desiredSize");return"errored"===(e=(t=this._ownerWritableStream)._state)||"erroring"===e?null:"closed"===e?0:V(t._writableStreamController);var e,t},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"ready",{get:function(){return!1===I(this)?Promise.reject($("ready")):this._readyPromise},enumerable:!0,configurable:!0}),q.prototype.abort=function(e){return!1===I(this)?Promise.reject($("abort")):void 0===this._ownerWritableStream?Promise.reject(X("abort")):P(this._ownerWritableStream,e)},q.prototype.close=function(){if(!1===I(this))return Promise.reject($("close"));var e=this._ownerWritableStream;return void 0===e?Promise.reject(X("close")):!0===O(e)?Promise.reject(new TypeError("cannot close an already-closing stream")):D(this)},q.prototype.releaseLock=function(){if(!1===I(this))throw $("releaseLock");void 0!==this._ownerWritableStream&&U(this)},q.prototype.write=function(e){return!1===I(this)?Promise.reject($("write")):void 0===this._ownerWritableStream?Promise.reject(X("write to")):W(this,e)},q);function q(e){if(!1===C(e))throw new TypeError("WritableStreamDefaultWriter can only be constructed with a WritableStream instance");if(!0===k(e))throw new TypeError("This stream has already been locked for exclusive writing by another writer");(this._ownerWritableStream=e)._writer=this;var t=e._state;"writable"===t?((!1===O(e)&&!0===e._backpressure?oe:ie)(this),Z(this)):"erroring"===t?(ne(this,e._storedError),Z(this)):"closed"===t?(ie(this),Z(t=this),re(t)):(ne(this,e=e._storedError),ee(this,e))}function I(e){return!!n(e)&&!!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")}function D(e){var r=e._ownerWritableStream,t=r._state;if("closed"===t||"errored"===t)return Promise.reject(new TypeError("The stream (in "+t+" state) is not in the writable state and cannot be closed"));var o=new Promise(function(e,t){r._closeRequest={_resolve:e,_reject:t}});return!0===r._backpressure&&"writable"===t&&se(e),c(e=r._writableStreamController,"close",0),H(e),o}function x(e,t){("pending"===e._readyPromiseState?ae:ne)(e,t)}function U(e){var t,r=e._ownerWritableStream,o=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");x(e,o),t=o,("pending"===(o=e)._closedPromiseState?te:ee)(o,t),r._writer=void 0,e._ownerWritableStream=void 0}function W(e,o){var t=(i=e._ownerWritableStream)._writableStreamController,r=function(e,t){try{return e._strategySizeAlgorithm(t)}catch(t){return Y(e,t),1}}(t,o);if(i!==e._ownerWritableStream)return Promise.reject(X("write to"));if("errored"===(e=i._state))return Promise.reject(i._storedError);if(!0===O(i)||"closed"===e)return Promise.reject(new TypeError("The stream is closing or closed and cannot be written to"));if("erroring"===e)return Promise.reject(i._storedError);var n,i=(n=i,new Promise(function(e,t){n._writeRequests.push({_resolve:e,_reject:t})}));return function(e,t){var r={chunk:o};try{c(e,r,t)}catch(t){return Y(e,t)}!1===O(t=e._controlledWritableStream)&&"writable"===t._state&&L(t,J(e)),H(e)}(t,r),i}var F=(z.prototype.error=function(e){if(0==(!!n(this)&&!!Object.prototype.hasOwnProperty.call(this,"_controlledWritableStream")))throw new TypeError("WritableStreamDefaultController.prototype.error can only be used on a WritableStreamDefaultController");"writable"===this._controlledWritableStream._state&&Q(this,e)},z.prototype[b]=function(e){return e=this._abortAlgorithm(e),G(this),e},z.prototype[v]=function(){u(this)},z);function z(){throw new TypeError("WritableStreamDefaultController cannot be constructed explicitly")}function N(t,r,e,o,n,i,a,s){((r._controlledWritableStream=t)._writableStreamController=r)._queue=void 0,r._queueTotalSize=void 0,u(r),r._started=!1,r._strategySizeAlgorithm=s,r._strategyHWM=a,r._writeAlgorithm=o,r._closeAlgorithm=n,r._abortAlgorithm=i,i=J(r),L(t,i),e=e(),Promise.resolve(e).then(function(){r._started=!0,H(r)},function(e){r._started=!0,E(t,e)}).catch(R)}function G(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function V(e){return e._strategyHWM-e._queueTotalSize}function H(e){var r,t,o,n=e._controlledWritableStream;!1!==e._started&&void 0===n._inFlightWriteRequest&&("erroring"!==n._state?0!==e._queue.length&&("close"===(t=e._queue[0].value)?function(e){var r=e._controlledWritableStream;(t=r)._inFlightCloseRequest=t._closeRequest,t._closeRequest=void 0,d(e);var t=e._closeAlgorithm();G(e),t.then(function(){var e;(e=r)._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,"erroring"!==e._state||(e._storedError=void 0)!==e._pendingAbortRequest&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0),e._state="closed",void 0!==(e=e._writer)&&re(e)},function(e){var t=e;(e=r)._inFlightCloseRequest._reject(t),(e._inFlightCloseRequest=void 0)!==e._pendingAbortRequest&&(e._pendingAbortRequest._reject(t),e._pendingAbortRequest=void 0),E(e,t)}).catch(R)}(e):(r=e,t=t.chunk,(o=r._controlledWritableStream)._inFlightWriteRequest=o._writeRequests.shift(),r._writeAlgorithm(t).then(function(){(e=o)._inFlightWriteRequest._resolve(void 0),e._inFlightWriteRequest=void 0;var e=o._state;d(r),!1===O(o)&&"writable"===e&&(e=J(r),L(o,e)),H(r)},function(e){var t;"writable"===o._state&&G(r),t=e,(e=o)._inFlightWriteRequest._reject(t),e._inFlightWriteRequest=void 0,E(e,t)}).catch(R))):j(n))}function Y(e,t){"writable"===e._controlledWritableStream._state&&Q(e,t)}function J(e){return V(e)<=0}function Q(e,t){var r=e._controlledWritableStream;G(e),A(r,t)}function K(e){return new TypeError("WritableStream.prototype."+e+" can only be used on a WritableStream")}function $(e){return new TypeError("WritableStreamDefaultWriter.prototype."+e+" can only be used on a WritableStreamDefaultWriter")}function X(e){return new TypeError("Cannot "+e+" a stream using a released writer")}function Z(r){r._closedPromise=new Promise(function(e,t){r._closedPromise_resolve=e,r._closedPromise_reject=t,r._closedPromiseState="pending"})}function ee(e,t){Z(e),te(e,t)}function te(e,t){e._closedPromise.catch(function(){}),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected"}function re(e){e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved"}function oe(r){r._readyPromise=new Promise(function(e,t){r._readyPromise_resolve=e,r._readyPromise_reject=t}),r._readyPromiseState="pending"}function ne(e,t){oe(e),ae(e,t)}function ie(e){oe(e),se(e)}function ae(e,t){e._readyPromise.catch(function(){}),e._readyPromise_reject(t),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected"}function se(e){e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled"}var de=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};"symbol"==$t(t.asyncIterator)&&((Bt={})[t.asyncIterator]=function(){return this},qt=Bt,Object.defineProperty(qt,t.asyncIterator,{enumerable:!1}));var ce=t("[[CancelSteps]]"),ue=t("[[PullSteps]]"),le=(Object.defineProperty(he.prototype,"locked",{get:function(){if(!1===be(this))throw _t("locked");return ve(this)},enumerable:!0,configurable:!0}),he.prototype.cancel=function(e){return!1===be(this)?Promise.reject(_t("cancel")):!0===ve(this)?Promise.reject(new TypeError("Cannot cancel a stream that already has a reader")):Se(this,e)},he.prototype.getReader=function(e){if(e=(void 0===e?{}:e).mode,!1===be(this))throw _t("getReader");if(void 0===e)return me(this,!0);if("byob"===(e=String(e)))return void 0===(t=!0)&&(t=!1),(e=new Le(e=this))._forAuthorCode=t,e;var t;throw new RangeError("Invalid mode is specified")},he.prototype.pipeThrough=function(e,t){var r=e.writable,o=e.readable,n=(i=void 0===t?{}:t).preventClose,e=i.preventAbort,t=i.preventCancel,i=i.signal;if(!1===be(this))throw _t("pipeThrough");if(!1===C(r))throw new TypeError("writable argument to pipeThrough must be a WritableStream");if(!1===be(o))throw new TypeError("readable argument to pipeThrough must be a ReadableStream");if(n=Boolean(n),e=Boolean(e),t=Boolean(t),void 0!==i&&!wt(i))throw new TypeError("ReadableStream.prototype.pipeThrough's signal option must be an AbortSignal");if(!0===ve(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(!0===k(r))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");return we(this,r,n,e,t,i).catch(function(){}),o},he.prototype.pipeTo=function(e,t){var r=(n=void 0===t?{}:t).preventClose,o=n.preventAbort,t=n.preventCancel,n=n.signal;return!1===be(this)?Promise.reject(_t("pipeTo")):!1===C(e)?Promise.reject(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream")):(r=Boolean(r),o=Boolean(o),t=Boolean(t),void 0===n||wt(n)?!0===ve(this)?Promise.reject(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):!0===k(e)?Promise.reject(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):we(this,e,r,o,t,n):Promise.reject(new TypeError("ReadableStream.prototype.pipeTo's signal option must be an AbortSignal")))},he.prototype.tee=function(){if(!1===be(this))throw _t("tee");var t,r,o,n,i,a,e,s,d,c,u,l=(e=me(t=this),c=d=s=!1,u=new Promise(function(e){a=e}),n=pe(h,f,function(e){return r=e,(d=!0)===c&&(e=m([r,o]),e=Se(t,e),a(e)),u}),i=pe(h,f,function(e){return o=e,(c=!0)===d&&(e=m([r,o]),e=Se(t,e),a(e)),u}),e._closedPromise.catch(function(e){Ke(n._readableStreamController,e),Ke(i._readableStreamController,e)}),[n,i]);function f(){return Fe(e).then(function(e){if(!0!==s){if(!0===e.done)return!1===d&&Je(n._readableStreamController),!1===c&&Je(i._readableStreamController),void(s=!0);var t=e.value,e=t;!1===d&&Qe(n._readableStreamController,t),!1===c&&Qe(i._readableStreamController,e)}})}function h(){}return m(l)},he.prototype.getIterator=function(e){var t=(void 0===e?{}:e).preventCancel;if(!1===be(this))throw _t("getIterator");var r=me(this);return(e=Object.create(fe))._asyncIteratorReader=r,e._preventCancel=Boolean(t),e},he),fe={next:function(){if(!1===ye(this))return Promise.reject(Rt("next"));var r=this._asyncIteratorReader;return void 0===r._ownerReadableStream?Promise.reject(St("iterate")):Fe(r).then(function(e){var t=e.done;return t&&We(r),Ce(e.value,t,!0)})},return:function(e){if(!1===ye(this))return Promise.reject(Rt("next"));var t=this._asyncIteratorReader;if(void 0===t._ownerReadableStream)return Promise.reject(St("finish iterating"));if(0<t._readRequests.length)return Promise.reject(new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled"));if(!1!==this._preventCancel)return We(t),Promise.resolve(Ce(e,!0,!0));var r=Ue(t,e);return We(t),r.then(function(){return Ce(e,!0,!0)})}};function he(e,t){void 0===e&&(e={}),void 0===t&&(t={}),ge(this);var r,o=t.size,n=t.highWaterMark,i=e.type;if("bytes"===String(i)){if(void 0!==o)throw new RangeError("The strategy for a byte stream cannot have a size function");!function(e,t,r){var o,n=Object.create(tt.prototype),i=l(t,"pull",0,[n]),a=l(t,"cancel",1,[]),s=t.autoAllocateChunkSize;if(void 0!==s&&(s=Number(s),!1===de(s)||s<=0))throw new RangeError("autoAllocateChunkSize must be a positive integer");e=e,i=i,a=a,r=r,s=s,(o=n)._controlledReadableByteStream=e,o._pullAgain=!1,o._pulling=!1,o._byobRequest=void 0,o._queue=o._queueTotalSize=void 0,u(o),o._closeRequested=!1,o._started=!1,o._strategyHWM=p(r),o._pullAlgorithm=i,o._cancelAlgorithm=a,o._autoAllocateChunkSize=s,o._pendingPullIntos=[],e._readableStreamController=o,e=f(t,"start",[n]),Promise.resolve(e).then(function(){o._started=!0,at(o)},function(e){vt(o,e)}).catch(R)}(this,e,n=p(n=void 0===n?0:n))}else{if(void 0!==i)throw new RangeError("Invalid type is specified");var t=g(o),a=e,o=n=p(n=void 0===n?1:n);e=t,r=Object.create(ze.prototype),n=l(a,"pull",0,[r]),t=l(a,"cancel",1,[]),Ze(this,r,function(){return f(a,"start",[r])},n,t,o,e)}}function me(e,t){return void 0===t&&(t=!1),(e=new Me(e))._forAuthorCode=t,e}function pe(e,t,r,o,n){void 0===o&&(o=1),void 0===n&&(n=function(){return 1});var i=Object.create(le.prototype);return ge(i),Ze(i,Object.create(ze.prototype),e,t,r,o,n),i}function ge(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function be(e){return!!n(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")}function ve(e){return void 0!==e._reader}function ye(e){return!!n(e)&&!!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorReader")}function we(l,f,h,m,p,g){var b=me(l),v=S(f),y=!1,w=Promise.resolve();return new Promise(function(r,o){var n,e,t,i;if(void 0!==g){if(n=function(){var e=new DOMException("Aborted","AbortError"),t=[];!1===m&&t.push(function(){return"writable"===f._state?P(f,e):Promise.resolve()}),!1===p&&t.push(function(){return"readable"===l._state?Se(l,e):Promise.resolve()}),d(function(){return function(e,r){var o,n;void 0===r&&(r=void 0);var t=new Promise(function(e,t){o=e,n=t});return void 0===r&&(r=function(e){throw e}),_(e,function(e){try{o(e)}catch(e){n(e)}},function(e){try{var t=r(e);o(t)}catch(e){n(e)}}),t}(t.map(function(e){return e()}))},!0,e)},!0===g.aborted)return void n();g.addEventListener("abort",n)}function a(){var e=w;return w.then(function(){return e!==w?a():void 0})}function s(e,t,r){"errored"===e._state?r(e._storedError):t.catch(r).catch(R)}function d(e,t,r){function o(){e().then(function(){return u(t,r)},function(e){return u(!0,e)}).catch(R)}!0!==y&&(y=!0,"writable"===f._state&&!1===O(f)?a().then(o):o())}function c(e,t){!0!==y&&(y=!0,"writable"===f._state&&!1===O(f)?a().then(function(){return u(e,t)}).catch(R):u(e,t))}function u(e,t){U(v),We(b),void 0!==g&&g.removeEventListener("abort",n),e?o(t):r(void 0)}s(l,b._closedPromise,function(e){!1===m?d(function(){return P(f,e)},!0,e):c(!0,e)}),s(f,v._closedPromise,function(e){!1===p?d(function(){return Se(l,e)},!0,e):c(!0,e)}),t=b._closedPromise,i=function(){!1===h?d(function(){return r=(t=(e=v)._ownerWritableStream)._state,!0===O(t)||"closed"===r?Promise.resolve():"errored"===r?Promise.reject(t._storedError):D(e);var e,t,r}):c()},"closed"===l._state?i():t.then(i).catch(R),!0!==O(f)&&"closed"!==f._state||(e=new TypeError("the destination writable stream closed before all data could be piped to it"),!1===p?d(function(){return Se(l,e)},!0,e):c(!0,e)),new Promise(function(r,o){!function e(t){t?r():(!0===y?Promise.resolve(!0):v._readyPromise.then(function(){return Fe(b).then(function(e){var t=e.value;return!0===e.done||(w=W(v,t).catch(function(){}),!1)})})).then(e,o)}(!1)}).catch(R)})}function _e(r){return new Promise(function(e,t){r._reader._readIntoRequests.push({_resolve:e,_reject:t})})}function Re(r){return new Promise(function(e,t){r._reader._readRequests.push({_resolve:e,_reject:t})})}function Se(e,t){return e._disturbed=!0,"closed"===e._state?Promise.resolve(void 0):"errored"===e._state?Promise.reject(e._storedError):(Te(e),e._readableStreamController[ce](t).then(function(){}))}function Te(e){e._state="closed";var t=e._reader;if(void 0!==t){if(De(t)){for(var r=0,o=t._readRequests;r<o.length;r++)(0,o[r]._resolve)(Ce(void 0,!0,t._forAuthorCode));t._readRequests=[]}Et(t)}}function Ce(e,t,r){var o=null;return!0===r&&(o=Object.prototype),o=Object.create(o),Object.defineProperty(o,"value",{value:e,enumerable:!0,writable:!0,configurable:!0}),Object.defineProperty(o,"done",{value:t,enumerable:!0,writable:!0,configurable:!0}),o}function ke(e,t){if(e._state="errored",e._storedError=t,void 0!==(e=e._reader)){if(De(e)){for(var r=0,o=e._readRequests;r<o.length;r++)o[r]._reject(t);e._readRequests=[]}else{for(var n=0,i=e._readIntoRequests;n<i.length;n++)i[n]._reject(t);e._readIntoRequests=[]}Pt(e,t)}}function Pe(e,t,r){(e=e._reader)._readRequests.shift()._resolve(Ce(t,r,e._forAuthorCode))}function Ee(e){return e._reader._readIntoRequests.length}function Ae(e){return e._reader._readRequests.length}function je(e){return void 0!==(e=e._reader)&&!!Ie(e)}function Oe(e){return void 0!==(e=e._reader)&&!!De(e)}void 0!==qt&&Object.setPrototypeOf(fe,qt),Object.defineProperty(fe,"next",{enumerable:!1}),Object.defineProperty(fe,"return",{enumerable:!1}),"symbol"==$t(t.asyncIterator)&&Object.defineProperty(le.prototype,t.asyncIterator,{value:le.prototype.getIterator,enumerable:!1,writable:!0,configurable:!0});var Me=(Object.defineProperty(qe.prototype,"closed",{get:function(){return De(this)?this._closedPromise:Promise.reject(Tt("closed"))},enumerable:!0,configurable:!0}),qe.prototype.cancel=function(e){return De(this)?void 0===this._ownerReadableStream?Promise.reject(St("cancel")):Ue(this,e):Promise.reject(Tt("cancel"))},qe.prototype.read=function(){return De(this)?void 0===this._ownerReadableStream?Promise.reject(St("read from")):Fe(this):Promise.reject(Tt("read"))},qe.prototype.releaseLock=function(){if(!De(this))throw Tt("releaseLock");if(void 0!==this._ownerReadableStream){if(0<this._readRequests.length)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");We(this)}},qe),Le=(Object.defineProperty(Be.prototype,"closed",{get:function(){return Ie(this)?this._closedPromise:Promise.reject(At("closed"))},enumerable:!0,configurable:!0}),Be.prototype.cancel=function(e){return Ie(this)?void 0===this._ownerReadableStream?Promise.reject(St("cancel")):Ue(this,e):Promise.reject(At("cancel"))},Be.prototype.read=function(e){return Ie(this)?void 0===this._ownerReadableStream?Promise.reject(St("read from")):ArrayBuffer.isView(e)?(e.buffer,0===e.byteLength?Promise.reject(new TypeError("view must have non-zero byteLength")):(i=e,(e=(e=this)._ownerReadableStream)._disturbed=!0,"errored"===e._state?Promise.reject(e._storedError):function(e){var t=e._controlledReadableByteStream,r=1;i.constructor!==DataView&&(r=i.constructor.BYTES_PER_ELEMENT);var o=i.constructor,r={buffer:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength,bytesFilled:0,elementSize:r,ctor:o,readerType:"byob"};if(0<e._pendingPullIntos.length)return e._pendingPullIntos.push(r),_e(t);if("closed"===t._state)return o=new o(r.buffer,r.byteOffset,0),Promise.resolve(Ce(o,!0,t._reader._forAuthorCode));if(0<e._queueTotalSize){if(!0===ut(e,r)){var n=dt(r);return ft(e),Promise.resolve(Ce(n,!1,t._reader._forAuthorCode))}if(!0===e._closeRequested)return vt(e,n=new TypeError("Insufficient bytes to fill elements in the given buffer")),Promise.reject(n)}return e._pendingPullIntos.push(r),t=_e(t),at(e),t}(e._readableStreamController))):Promise.reject(new TypeError("view must be an array buffer view")):Promise.reject(At("read"));var i},Be.prototype.releaseLock=function(){if(!Ie(this))throw At("releaseLock");if(void 0!==this._ownerReadableStream){if(0<this._readIntoRequests.length)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");We(this)}},Be);function Be(e){if(!be(e))throw new TypeError("ReadableStreamBYOBReader can only be constructed with a ReadableStream instance given a byte source");if(!1===nt(e._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");if(ve(e))throw new TypeError("This stream has already been locked for exclusive reading by another reader");xe(this,e),this._readIntoRequests=[]}function qe(e){if(!1===be(e))throw new TypeError("ReadableStreamDefaultReader can only be constructed with a ReadableStream instance");if(!0===ve(e))throw new TypeError("This stream has already been locked for exclusive reading by another reader");xe(this,e),this._readRequests=[]}function Ie(e){return n(e)&&Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")}function De(e){return n(e)&&Object.prototype.hasOwnProperty.call(e,"_readRequests")}function xe(e,t){var r;e._forAuthorCode=!0,(e._ownerReadableStream=t)._reader=e,"readable"===t._state?Ct(e):"closed"===t._state?(Ct(r=e),Et(r)):kt(e,t._storedError)}function Ue(e,t){return Se(e._ownerReadableStream,t)}function We(e){("readable"===e._ownerReadableStream._state?Pt:kt)(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),e._ownerReadableStream._reader=void 0,e._ownerReadableStream=void 0}function Fe(e){var t=e._ownerReadableStream;return t._disturbed=!0,"closed"===t._state?Promise.resolve(Ce(void 0,!0,e._forAuthorCode)):"errored"===t._state?Promise.reject(t._storedError):t._readableStreamController[ue]()}var ze=(Object.defineProperty(Ne.prototype,"desiredSize",{get:function(){if(!1===Ge(this))throw jt("desiredSize");return $e(this)},enumerable:!0,configurable:!0}),Ne.prototype.close=function(){if(!1===Ge(this))throw jt("close");if(!1===Xe(this))throw new TypeError("The stream is not in a state that permits close");Je(this)},Ne.prototype.enqueue=function(e){if(!1===Ge(this))throw jt("enqueue");if(!1===Xe(this))throw new TypeError("The stream is not in a state that permits enqueue");return Qe(this,e)},Ne.prototype.error=function(e){if(!1===Ge(this))throw jt("error");Ke(this,e)},Ne.prototype[ce]=function(e){return u(this),e=this._cancelAlgorithm(e),Ye(this),e},Ne.prototype[ue]=function(){var e=this._controlledReadableStream;if(0<this._queue.length){var t=d(this);return!0===this._closeRequested&&0===this._queue.length?(Ye(this),Te(e)):Ve(this),Promise.resolve(Ce(t,!1,e._reader._forAuthorCode))}return e=Re(e),Ve(this),e},Ne);function Ne(){throw new TypeError}function Ge(e){return!!n(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")}function Ve(t){!1!==He(t)&&(!0!==t._pulling?(t._pulling=!0,t._pullAlgorithm().then(function(){!(t._pulling=!1)===t._pullAgain&&(t._pullAgain=!1,Ve(t))},function(e){Ke(t,e)}).catch(R)):t._pullAgain=!0)}function He(e){var t=e._controlledReadableStream;return!1!==Xe(e)&&!1!==e._started&&(!0===ve(t)&&0<Ae(t)||0<$e(e))}function Ye(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Je(e){var t=e._controlledReadableStream;e._closeRequested=!0,0===e._queue.length&&(Ye(e),Te(t))}function Qe(e,t){var r=e._controlledReadableStream;if(!0===ve(r)&&0<Ae(r))Pe(r,t,!1);else{r=void 0;try{r=e._strategySizeAlgorithm(t)}catch(t){throw Ke(e,t),t}try{c(e,t,r)}catch(t){throw Ke(e,t),t}}Ve(e)}function Ke(e,t){var r=e._controlledReadableStream;"readable"===r._state&&(u(e),Ye(e),ke(r,t))}function $e(e){var t=e._controlledReadableStream._state;return"errored"===t?null:"closed"===t?0:e._strategyHWM-e._queueTotalSize}function Xe(e){var t=e._controlledReadableStream._state;return!1===e._closeRequested&&"readable"===t}function Ze(e,t,r,o,n,i,a){t._controlledReadableStream=e,t._queue=void 0,t._queueTotalSize=void 0,u(t),t._started=!1,t._closeRequested=!1,t._pullAgain=!1,t._pulling=!1,t._strategySizeAlgorithm=a,t._strategyHWM=i,t._pullAlgorithm=o,t._cancelAlgorithm=n,e._readableStreamController=t,r=r(),Promise.resolve(r).then(function(){t._started=!0,Ve(t)},function(e){Ke(t,e)}).catch(R)}var et=(Object.defineProperty(ot.prototype,"view",{get:function(){if(!1===it(this))throw Ot("view");return this._view},enumerable:!0,configurable:!0}),ot.prototype.respond=function(r){if(!1===it(this))throw Ot("respond");if(void 0===this._associatedReadableByteStreamController)throw new TypeError("This BYOB request has been invalidated");this._view.buffer,function(e,t){if(!1===a(t=Number(r)))throw new RangeError("bytesWritten must be a finite");pt(e,t)}(this._associatedReadableByteStreamController)},ot.prototype.respondWithNewView=function(e){if(!1===it(this))throw Ot("respond");if(void 0===this._associatedReadableByteStreamController)throw new TypeError("This BYOB request has been invalidated");if(!ArrayBuffer.isView(e))throw new TypeError("You can only respond with array buffer views");e.buffer,function(e,t){var r=e._pendingPullIntos[0];if(r.byteOffset+r.bytesFilled!==t.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(r.byteLength!==t.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");r.buffer=t.buffer,pt(e,t.byteLength)}(this._associatedReadableByteStreamController,e)},ot),tt=(Object.defineProperty(rt.prototype,"byobRequest",{get:function(){if(!1===nt(this))throw Mt("byobRequest");var e,t,r;return void 0===this._byobRequest&&0<this._pendingPullIntos.length&&(r=this._pendingPullIntos[0],r=t=new Uint8Array(r.buffer,r.byteOffset+r.bytesFilled,r.byteLength-r.bytesFilled),(t=e=Object.create(et.prototype))._associatedReadableByteStreamController=this,t._view=r,this._byobRequest=e),this._byobRequest},enumerable:!0,configurable:!0}),Object.defineProperty(rt.prototype,"desiredSize",{get:function(){if(!1===nt(this))throw Mt("desiredSize");return yt(this)},enumerable:!0,configurable:!0}),rt.prototype.close=function(){if(!1===nt(this))throw Mt("close");if(!0===this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");var e=this._controlledReadableByteStream._state;if("readable"!==e)throw new TypeError("The stream (in "+e+" state) is not in the readable state and cannot be closed");!function(e){var t=e._controlledReadableByteStream;if(0<e._queueTotalSize)return e._closeRequested=!0;if(0<e._pendingPullIntos.length&&0<e._pendingPullIntos[0].bytesFilled){var r=new TypeError("Insufficient bytes to fill elements in the given buffer");throw vt(e,r),r}bt(e),Te(t)}(this)},rt.prototype.enqueue=function(e){if(!1===nt(this))throw Mt("enqueue");if(!0===this._closeRequested)throw new TypeError("stream is closed or draining");var t,r,o,n=this._controlledReadableByteStream._state;if("readable"!==n)throw new TypeError("The stream (in "+n+" state) is not in the readable state and cannot be enqueued to");if(!ArrayBuffer.isView(e))throw new TypeError("You can only enqueue array buffer views when using a ReadableByteStreamController");e.buffer,r=(t=this)._controlledReadableByteStream,o=e.buffer,n=e.byteOffset,e=e.byteLength,!0===Oe(r)?0===Ae(r)?ct(t,o,n,e):Pe(r,new Uint8Array(o,n,e),!1):!0===je(r)?(ct(t,o,n,e),mt(t)):ct(t,o,n,e),at(t)},rt.prototype.error=function(e){if(!1===nt(this))throw Mt("error");vt(this,e)},rt.prototype[ce]=function(e){return 0<this._pendingPullIntos.length&&(this._pendingPullIntos[0].bytesFilled=0),u(this),e=this._cancelAlgorithm(e),bt(this),e},rt.prototype[ue]=function(){var e=this._controlledReadableByteStream;if(0<this._queueTotalSize){var t=this._queue.shift();this._queueTotalSize-=t.byteLength,ft(this);var r=void 0;try{r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}catch(e){return Promise.reject(e)}return Promise.resolve(Ce(r,!1,e._reader._forAuthorCode))}if(void 0!==(r=this._autoAllocateChunkSize)){var o=void 0;try{o=new ArrayBuffer(r)}catch(e){return Promise.reject(e)}o={buffer:o,byteOffset:0,byteLength:r,bytesFilled:0,elementSize:1,ctor:Uint8Array,readerType:"default"},this._pendingPullIntos.push(o)}return o=Re(e),at(this),o},rt);function rt(){throw new TypeError("ReadableByteStreamController constructor cannot be used directly")}function ot(){throw new TypeError("ReadableStreamBYOBRequest cannot be used directly")}function nt(e){return!!n(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")}function it(e){return!!n(e)&&!!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")}function at(t){var e,r;0!=("readable"===(r=(e=t)._controlledReadableByteStream)._state&&!0!==e._closeRequested&&!1!==e._started&&(!0===Oe(r)&&0<Ae(r)||!0===je(r)&&0<Ee(r)||0<yt(e)))&&(!0!==t._pulling?(t._pulling=!0,t._pullAlgorithm().then(function(){!(t._pulling=!1)===t._pullAgain&&(t._pullAgain=!1,at(t))},function(e){vt(t,e)}).catch(R)):t._pullAgain=!0)}function st(e,t){var r=!1;"closed"===e._state&&(r=!0);var o=dt(t);"default"===t.readerType?Pe(e,o,r):(e=e._reader)._readIntoRequests.shift()._resolve(Ce(o,r,e._forAuthorCode))}function dt(e){var t=e.bytesFilled,r=e.elementSize;return new e.ctor(e.buffer,e.byteOffset,t/r)}function ct(e,t,r,o){e._queue.push({buffer:t,byteOffset:r,byteLength:o}),e._queueTotalSize+=o}function ut(e,t){var r=t.elementSize,o=t.bytesFilled-t.bytesFilled%r,n=Math.min(e._queueTotalSize,t.byteLength-t.bytesFilled),i=t.bytesFilled+n,a=n,n=!1;o<(r=i-i%r)&&(a=r-t.bytesFilled,n=!0);for(var s=e._queue;0<a;){var d=s[0],c=Math.min(a,d.byteLength),u=t.byteOffset+t.bytesFilled,l=t.buffer,f=u,h=d.buffer,m=d.byteOffset,u=c;new Uint8Array(l).set(new Uint8Array(h,m,u),f),d.byteLength===c?s.shift():(d.byteOffset+=c,d.byteLength-=c),e._queueTotalSize-=c,lt(e,c,t),a-=c}return n}function lt(e,t,r){ht(e),r.bytesFilled+=t}function ft(e){0===e._queueTotalSize&&!0===e._closeRequested?(bt(e),Te(e._controlledReadableByteStream)):at(e)}function ht(e){void 0!==e._byobRequest&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=void 0,e._byobRequest=void 0)}function mt(e){for(;0<e._pendingPullIntos.length;){if(0===e._queueTotalSize)return;var t=e._pendingPullIntos[0];!0===ut(e,t)&&(gt(e),st(e._controlledReadableByteStream,t))}}function pt(e,t){var r=e._pendingPullIntos[0];if("closed"===e._controlledReadableByteStream._state){if(0!==t)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream");!function(e){r.buffer=r.buffer;var t=e._controlledReadableByteStream;if(!0===je(t))for(;0<Ee(t);)st(t,gt(e))}(e)}else!function(e,t,r){if(r.bytesFilled+t>r.byteLength)throw new RangeError("bytesWritten out of range");var o;lt(e,t,r),r.bytesFilled<r.elementSize||(gt(e),0<(o=r.bytesFilled%r.elementSize)&&(t=r.byteOffset+r.bytesFilled,ct(e,t=r.buffer.slice(t-o,t),0,t.byteLength)),r.buffer=r.buffer,r.bytesFilled-=o,st(e._controlledReadableByteStream,r),mt(e))}(e,t,r);at(e)}function gt(e){var t=e._pendingPullIntos.shift();return ht(e),t}function bt(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function vt(e,t){var r,o=e._controlledReadableByteStream;"readable"===o._state&&(ht(r=e),r._pendingPullIntos=[],u(e),bt(e),ke(o,t))}function yt(e){var t=e._controlledReadableByteStream._state;return"errored"===t?null:"closed"===t?0:e._strategyHWM-e._queueTotalSize}function wt(e){if("object"==$t(e)&&null!==e){var t=Object.getOwnPropertyDescriptor(AbortSignal.prototype,"aborted").get;try{return t.call(e),1}catch(e){return}}}function _t(e){return new TypeError("ReadableStream.prototype."+e+" can only be used on a ReadableStream")}function Rt(e){return new TypeError("ReadableStreamAsyncIterator."+e+" can only be used on a ReadableSteamAsyncIterator")}function St(e){return new TypeError("Cannot "+e+" a stream using a released reader")}function Tt(e){return new TypeError("ReadableStreamDefaultReader.prototype."+e+" can only be used on a ReadableStreamDefaultReader")}function Ct(r){r._closedPromise=new Promise(function(e,t){r._closedPromise_resolve=e,r._closedPromise_reject=t})}function kt(e,t){Ct(e),Pt(e,t)}function Pt(e,t){e._closedPromise.catch(function(){}),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0}function Et(e){e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0}function At(e){return new TypeError("ReadableStreamBYOBReader.prototype."+e+" can only be used on a ReadableStreamBYOBReader")}function jt(e){return new TypeError("ReadableStreamDefaultController.prototype."+e+" can only be used on a ReadableStreamDefaultController")}function Ot(e){return new TypeError("ReadableStreamBYOBRequest.prototype."+e+" can only be used on a ReadableStreamBYOBRequest")}function Mt(e){return new TypeError("ReadableByteStreamController.prototype."+e+" can only be used on a ReadableByteStreamController")}var Lt=(xt.prototype.size=function(e){return e.byteLength},xt),Bt=(Dt.prototype.size=function(){return 1},Dt),qt=(Object.defineProperty(It.prototype,"readable",{get:function(){if(!1===Ut(this))throw Kt("readable");return this._readable},enumerable:!0,configurable:!0}),Object.defineProperty(It.prototype,"writable",{get:function(){if(!1===Ut(this))throw Kt("writable");return this._writable},enumerable:!0,configurable:!0}),It);function It(e,t,r){var o=(t=void 0===t?{}:t).size,n=t.highWaterMark,t=(r=void 0===r?{}:r).size,r=r.highWaterMark;if(void 0!==(e=void 0===e?{}:e).writableType)throw new RangeError("Invalid writable type specified");if(o=g(o),n=p(n=void 0===n?1:n),void 0!==e.readableType)throw new RangeError("Invalid readable type specified");var i,a,s,d,c,t=g(t);function u(){return s}r=p(r=void 0===r?0:r),a=this,s=new Promise(function(e){i=e}),d=n,c=o,a._writable=function(e,t,r){void 0===d&&(t=1),void 0===c&&(r=function(){return 1});var o=Object.create(y.prototype);return T(o),N(o,Object.create(F.prototype),e,function(e){return r=e,o=(t=a)._transformStreamController,!0!==t._backpressure?Jt(o,r):t._backpressureChangePromise.then(function(){var e=t._writable;if("erroring"===e._state)throw e._storedError;return Jt(o,r)});var t,r,o},function(){return r=(t=a)._readable,e=t._transformStreamController,o=e._flushAlgorithm(),Ht(e),o.then(function(){if("errored"===r._state)throw r._storedError;var e=r._readableStreamController;!0===Xe(e)&&Je(e)}).catch(function(e){throw Wt(t,e),r._storedError});var t,r,e,o},function(e){return Wt(a,e),Promise.resolve()},t,r),o}(u,d,c),a._readable=pe(u,function(){return zt(e=a,!1),e._backpressureChangePromise;var e},function(e){return Ft(a,e),Promise.resolve()},r,t),a._backpressure=void 0,a._backpressureChangePromise=void 0,a._backpressureChangePromise_resolve=void 0,zt(a,!0),a._transformStreamController=void 0,function(e,t){var r=Object.create(Nt.prototype),o=function(e){try{return Yt(r,e),Promise.resolve()}catch(e){return Promise.reject(e)}},n=t.transform;if(void 0!==n){if("function"!=typeof n)throw new TypeError("transform is not a method");o=function(e){return h(n,t,[e,r])}}var i=l(t,"flush",0,[r]),a=e;e=o,o=i,(((i=r)._controlledTransformStream=a)._transformStreamController=i)._transformAlgorithm=e,i._flushAlgorithm=o}(this,e),e=f(e,"start",[this._transformStreamController]),i(e)}function Dt(e){i(this,"highWaterMark",e.highWaterMark)}function xt(e){i(this,"highWaterMark",e.highWaterMark)}function Ut(e){return!!n(e)&&!!Object.prototype.hasOwnProperty.call(e,"_transformStreamController")}function Wt(e,t){Ke(e._readable._readableStreamController,t),Ft(e,t)}function Ft(e,t){Ht(e._transformStreamController),Y(e._writable._writableStreamController,t),!0===e._backpressure&&zt(e,!1)}function zt(t,e){void 0!==t._backpressureChangePromise&&t._backpressureChangePromise_resolve(),t._backpressureChangePromise=new Promise(function(e){t._backpressureChangePromise_resolve=e}),t._backpressure=e}var Nt=(Object.defineProperty(Gt.prototype,"desiredSize",{get:function(){if(!1===Vt(this))throw Qt("desiredSize");return $e(this._controlledTransformStream._readable._readableStreamController)},enumerable:!0,configurable:!0}),Gt.prototype.enqueue=function(e){if(!1===Vt(this))throw Qt("enqueue");Yt(this,e)},Gt.prototype.error=function(e){if(!1===Vt(this))throw Qt("error");Wt(this._controlledTransformStream,e)},Gt.prototype.terminate=function(){if(!1===Vt(this))throw Qt("terminate");var e,t;!0===Xe(e=(t=this._controlledTransformStream)._readable._readableStreamController)&&Je(e),Ft(t,new TypeError("TransformStream terminated"))},Gt);function Gt(){throw new TypeError("TransformStreamDefaultController instances cannot be created directly")}function Vt(e){return!!n(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream")}function Ht(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0}function Yt(e,t){var r=e._controlledTransformStream,o=r._readable._readableStreamController;if(!1===Xe(o))throw new TypeError("Readable side is not in a state that permits enqueue");try{Qe(o,t)}catch(e){throw Ft(r,e),r._readable._storedError}!0!==He(o)!==r._backpressure&&zt(r,!0)}function Jt(t,e){return t._transformAlgorithm(e).catch(function(e){throw Wt(t._controlledTransformStream,e),e})}function Qt(e){return new TypeError("TransformStreamDefaultController.prototype."+e+" can only be used on a TransformStreamDefaultController")}function Kt(e){return new TypeError("TransformStream.prototype."+e+" can only be used on a TransformStream")}t=Object.assign||function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var o=Object(e),n=0,i=t;n<i.length;n++){var a,s=i[n];for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(o[a]=s[a])}return o},void 0!==r&&t(r,{ReadableStream:le,WritableStream:y,ByteLengthQueuingStrategy:Lt,CountQueuingStrategy:Bt,TransformStream:qt}),e.ReadableStream=le,e.WritableStream=y,e.ByteLengthQueuingStrategy=Lt,e.CountQueuingStrategy=Bt,e.TransformStream=qt,Object.defineProperty(e,"__esModule",{value:!0})},"object"==("undefined"==typeof exports?"undefined":$t(exports))&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((r=r||self).WebStreamsPolyfill={});var e="1.0.2";function S(r,n){if(!r)throw"First parameter is required.";n=new m(r,n=n||{type:"video"});var i=this;function t(e){e&&(n.initCallback=function(){e(),e=n.initCallback=null});var t=new p(r,n);u=new t(r,n),console.log("getMediaStreamRecorder=",u),u.record(),c("recording"),n.disableLogs||console.log("Initialized recorderType:",u.constructor.name,"for output-type:",n.type)}function a(o){if(o=o||function(){},console.log("stopRecording666==",u),u){if("paused"===i.state)return i.resumeRecording(),void setTimeout(function(){a(o)},1);"recording"===i.state||n.disableLogs||console.warn('Recording state should be: "recording", however current state is: ',i.state),n.disableLogs||console.log("Stopped recording "+n.type+" stream."),"gif"!==n.type?u.stop(e):(u.stop(),e()),c("stopped")}else l();function e(e){if(u){Object.keys(u).forEach(function(e){"function"!=typeof u[e]&&(i[e]=u[e])});var t,r=u.blob;if(!r){if(!e)throw"Recording failed.";u.blob=r=e}if(r&&!n.disableLogs&&console.log(r.type,"->",v(r.size)),o){try{t=T.createObjectURL(r)}catch(e){}"function"==typeof o.call?o.call(i,t):o(t)}n.autoWriteToDisk&&d(function(e){var t={};t[n.type+"Blob"]=e,j.Store(t)})}else"function"==typeof o.call?o.call(i,""):o("")}}function s(e){postMessage((new FileReaderSync).readAsDataURL(e))}function d(t,e){if(!t)throw"Pass a callback function over getDataURL.";var r,o=(e||u||{}).blob;if(!o)return n.disableLogs||console.warn("Blob encoder did not finish its job yet."),void setTimeout(function(){d(t,e)},1e3);"undefined"==typeof Worker||navigator.mozGetUserMedia?((r=new FileReader).readAsDataURL(o),r.onload=function(e){t(e.target.result)}):((r=function(e){try{var t=T.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (eee) {"+e.name+"(eee.data);}"],{type:"application/javascript"})),r=new Worker(t);return T.revokeObjectURL(t),r}catch(e){}}(s)).onmessage=function(e){t(e.data)},r.postMessage(o))}function o(e){e=e||0,"paused"!==i.state?"stopped"!==i.state&&(e>=i.recordingDuration?a(i.onRecordingStopped):(e+=1e3,setTimeout(function(){o(e)},1e3))):setTimeout(function(){o(e)},1e3)}function c(e){i&&(i.state=e,"function"==typeof i.onStateChanged.call?i.onStateChanged.call(i,e):i.onStateChanged(e))}var u,e='It seems that recorder is destroyed or "startRecording" is not invoked for '+n.type+" recorder.";function l(){!0!==n.disableLogs&&console.warn(e)}var f,h={startRecording:function(e){return n.disableLogs||console.log("RecordRTC version: ",i.version),(n=e?new m(r,e):n).disableLogs||console.log("started recording "+n.type+" stream."),u?(u.clearRecordedData(),u.record(),c("recording"),i.recordingDuration&&o()):t(function(){i.recordingDuration&&o()}),i},stopRecording:a,pauseRecording:function(){u?"recording"===i.state?(c("paused"),u.pause(),n.disableLogs||console.log("Paused recording.")):n.disableLogs||console.warn("Unable to pause the recording. Recording state: ",i.state):l()},resumeRecording:function(){u?"paused"===i.state?(c("recording"),u.resume(),n.disableLogs||console.log("Resumed recording.")):n.disableLogs||console.warn("Unable to resume the recording. Recording state: ",i.state):l()},initRecorder:t,setRecordingDuration:function(e,t){if(void 0===e)throw"recordingDuration is required.";if("number"!=typeof e)throw"recordingDuration must be a number.";return i.recordingDuration=e,i.onRecordingStopped=t||function(){},{onRecordingStopped:function(e){i.onRecordingStopped=e}}},clearRecordedData:function(){u?(u.clearRecordedData(),n.disableLogs||console.log("Cleared old recorded data.")):l()},getBlob:function(){if(u)return new File([u.blob],"file-name.mp4",{type:"video/mp4"});l()},getDataURL:d,toURL:function(){if(u)return T.createObjectURL(u.blob);l()},getInternalRecorder:function(){return u},save:function(e){u?y(u.blob,e):l()},getFromDisk:function(e){u?S.getFromDisk(n.type,e):l()},setAdvertisementArray:function(e){n.advertisement=[];for(var t=e.length,r=0;r<t;r++)n.advertisement.push({duration:r,image:e[r]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){"recording"!==i.state||n.disableLogs||console.warn("Stop an active recorder."),u&&"function"==typeof u.clearRecordedData&&u.clearRecordedData(),u=null,c("inactive"),i.blob=null},onStateChanged:function(e){n.disableLogs||console.log("Recorder state changed:",e)},state:"inactive",getState:function(){return i.state},destroy:function(){var e=n.disableLogs;n={disableLogs:!0},i.reset(),c("destroyed"),h=i=null,_.AudioContextConstructor&&(_.AudioContextConstructor.close(),_.AudioContextConstructor=null),n.disableLogs=e,n.disableLogs||console.log("RecordRTC is destroyed.")},version:"5.6.2"};if(!this)return i=h;for(f in h)this[f]=h[f];return i=this,h}function m(e,t){return t.recorderType||t.type||(t.audio&&t.video?t.type="video":t.audio&&!t.video&&(t.type="audio")),t.recorderType&&!t.type&&(t.recorderType===k||t.recorderType===f||t.recorderType===B?t.type="video":t.recorderType===O?t.type="gif":t.recorderType===c?t.type="audio":t.recorderType===R&&(C(e,"audio").length&&C(e,"video").length||!C(e,"audio").length&&C(e,"video").length?t.type="video":C(e,"audio").length&&!C(e,"video").length&&(t.type="audio"))),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(t.mimeType||(t.mimeType="video/webm"),t.type||(t.type=t.mimeType.split("/")[0]),t.bitsPerSecond),t.type||(t.mimeType&&(t.type=t.mimeType.split("/")[0]),t.type||(t.type="audio")),t}function p(e,t){var r;return(u||n||a)&&(r=c),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!u&&(r=R),"video"===t.type&&(u||a)&&(r=k,"undefined"!=typeof ReadableStream&&(r=B)),"gif"===t.type&&(r=O),"canvas"===t.type&&(r=f),l()&&r!==f&&r!==O&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(C(e,"video").length||C(e,"audio").length)&&("audio"===t.type?"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm")&&(r=R):"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("video/webm")&&(r=R)),e instanceof Array&&e.length&&(r=L),t.recorderType&&(r=t.recorderType),!t.disableLogs&&r&&r.name&&console.log("Using recorderType:",r.name||r.constructor.name),!r&&d?R:r}function t(a){this.addStream=function(e){e&&(a=e)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var e,t,r,o,n=this.mediaType,i=this.mimeType||{audio:null,video:null,gif:null};if("function"!=typeof n.audio&&l()&&!C(a,"audio").length&&(n.audio=!1),"function"!=typeof n.video&&l()&&!C(a,"video").length&&(n.video=!1),"function"!=typeof n.gif&&l()&&!C(a,"video").length&&(n.gif=!1),!n.audio&&!n.video&&!n.gif)throw"MediaStream must have either audio or video tracks.";n.audio&&(e=null,"function"==typeof n.audio&&(e=n.audio),this.audioRecorder=new S(a,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:e,mimeType:i.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),n.video||this.audioRecorder.startRecording()),n.video&&(e=null,"function"==typeof n.video&&(e=n.video),o=a,l()&&n.audio&&"function"==typeof n.audio&&(t=C(a,"video")[0],s?((o=new b).addTrack(t),e&&e===k&&(e=R)):(o=new b).addTrack(t)),this.videoRecorder=new S(o,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:e,mimeType:i.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),n.audio||this.videoRecorder.startRecording()),n.audio&&n.video&&(r=this,o=!0===l(),!0===(o=!(n.audio instanceof c&&n.video||!0!==n.audio&&!0!==n.video&&n.audio!==n.video)&&o)?(r.audioRecorder=null,r.videoRecorder.startRecording()):r.videoRecorder.initRecorder(function(){r.audioRecorder.initRecorder(function(){r.videoRecorder.startRecording(),r.audioRecorder.startRecording()})})),n.gif&&(e=null,"function"==typeof n.gif&&(e=n.gif),this.gifRecorder=new S(a,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:e,mimeType:i.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(t){t=t||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(e){t(e,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(e){t(e,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(e){t(e,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(e){var t={};return this.audioRecorder&&(t.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(t.video=this.videoRecorder.getBlob()),this.gifRecorder&&(t.gif=this.gifRecorder.getBlob()),e&&e(t),t},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(r){function o(e,t){var r;"undefined"!=typeof Worker?((r=function(e){var t,r=T.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (eee) {"+e.name+"(eee.data);}"],{type:"application/javascript"})),e=new Worker(r);if(void 0!==T)t=T;else{if("undefined"==typeof webkitURL)throw"Neither URL nor webkitURL detected.";t=webkitURL}return t.revokeObjectURL(r),e}(function(e){postMessage((new FileReaderSync).readAsDataURL(e))})).onmessage=function(e){t(e.data)},r.postMessage(e)):((r=new FileReader).readAsDataURL(e),r.onload=function(e){t(e.target.result)})}this.getBlob(function(e){e.audio&&e.video?o(e.audio,function(t){o(e.video,function(e){r({audio:t,video:e})})}):e.audio?o(e.audio,function(e){r({audio:e})}):e.video&&o(e.video,function(e){r({video:e})})})},this.writeToDisk=function(){S.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){(e=e||{audio:!0,video:!0,gif:!0}).audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof e.audio?e.audio:""),e.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof e.video?e.video:""),e.gif&&this.gifRecorder&&this.gifRecorder.save("string"==typeof e.gif?e.gif:"")}}S.version="5.6.2","undefined"!=typeof module&&(module.exports=S),"function"==typeof define&&define.amd&&define("RecordRTC",[],function(){return S}),S.getFromDisk=function(r,o){if(!o)throw"callback is mandatory.";console.log("Getting recorded "+("all"===r?"blobs":r+" blob ")+" from disk!"),j.Fetch(function(e,t){"all"!==r&&t===r+"Blob"&&o&&o(e),"all"===r&&o&&o(e,t.replace("Blob",""))})},S.writeToDisk=function(e){console.log("Writing recorded blob(s) to disk!"),(e=e||{}).audio&&e.video&&e.gif?e.audio.getDataURL(function(r){e.video.getDataURL(function(t){e.gif.getDataURL(function(e){j.Store({audioBlob:r,videoBlob:t,gifBlob:e})})})}):e.audio&&e.video?e.audio.getDataURL(function(t){e.video.getDataURL(function(e){j.Store({audioBlob:t,videoBlob:e})})}):e.audio&&e.gif?e.audio.getDataURL(function(t){e.gif.getDataURL(function(e){j.Store({audioBlob:t,gifBlob:e})})}):e.video&&e.gif?e.video.getDataURL(function(t){e.gif.getDataURL(function(e){j.Store({videoBlob:t,gifBlob:e})})}):e.audio?e.audio.getDataURL(function(e){j.Store({audioBlob:e})}):e.video?e.video.getDataURL(function(e){j.Store({videoBlob:e})}):e.gif&&e.gif.getDataURL(function(e){j.Store({gifBlob:e})})},t.getFromDisk=S.getFromDisk,t.writeToDisk=S.writeToDisk,void 0!==S&&(S.MRecordRTC=t),(r="undefined"!=typeof global?global:null)&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},global.console||(global.console={}),void 0!==global.console.log&&void 0!==global.console.error||(global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(r.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return e},r.HTMLVideoElement=function(){}),"undefined"==typeof location&&(r.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(r.screen={width:0,height:0}),void 0===T&&(r.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),r.window=global);var i,h=window.requestAnimationFrame;void 0===h&&("undefined"!=typeof webkitRequestAnimationFrame?h=webkitRequestAnimationFrame:"undefined"!=typeof mozRequestAnimationFrame?h=mozRequestAnimationFrame:"undefined"!=typeof msRequestAnimationFrame?h=msRequestAnimationFrame:void 0===h&&(i=0,h=function(e,t){var r=(new Date).getTime(),o=Math.max(0,16-(r-i)),n=setTimeout(function(){e(r+o)},o);return i=r+o,n}));var g=window.cancelAnimationFrame;void 0===g&&("undefined"!=typeof webkitCancelAnimationFrame?g=webkitCancelAnimationFrame:"undefined"!=typeof mozCancelAnimationFrame?g=mozCancelAnimationFrame:"undefined"!=typeof msCancelAnimationFrame?g=msCancelAnimationFrame:void 0===g&&(g=function(e){clearTimeout(e)}));var r=window.AudioContext;void 0===r&&("undefined"!=typeof webkitAudioContext&&(r=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(r=mozAudioContext));var T=window.URL;void 0===T&&"undefined"!=typeof webkitURL&&(T=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var n=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),a=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),s=-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&"netscape"in window&&/ rv:/.test(navigator.userAgent),u=!a&&!n&&!!navigator.webkitGetUserMedia||o()||-1!==navigator.userAgent.toLowerCase().indexOf("chrome/"),d=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);d&&!u&&-1!==navigator.userAgent.indexOf("CriOS")&&(u=!(d=!1));var b=window.MediaStream;function v(e){if(0===e)return"0 Bytes";var t=parseInt(Math.floor(Math.log(e)/Math.log(1e3)),10);return(e/Math.pow(1e3,t)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][t]}function y(e,t){if(!e)throw"Blob object is required.";if(!e.type)try{e.type="video/webm"}catch(e){}var r,o=(e.type||"video/webm").split("/")[1];return-1!==o.indexOf(";")&&(o=o.split(";")[0]),t&&-1!==t.indexOf(".")&&(t=(r=t.split("."))[0],o=r[1]),t=(t||Math.round(9999999999*Math.random())+888888888)+"."+o,void 0!==navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(e,t):void 0!==navigator.msSaveBlob?navigator.msSaveBlob(e,t):((o=document.createElement("a")).href=T.createObjectURL(e),o.download=t,o.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(o),"function"==typeof o.click?o.click():(o.target="_blank",o.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),void T.revokeObjectURL(o.href))}function o(){return"undefined"!=typeof window&&"object"==$t(window.process)&&"renderer"===window.process.type||!("undefined"==typeof process||"object"!=$t(process.versions)||!process.versions.electron)||"object"==("undefined"==typeof navigator?"undefined":$t(navigator))&&"string"==typeof navigator.userAgent&&0<=navigator.userAgent.indexOf("Electron")}function C(e,t){return e&&e.getTracks?e.getTracks().filter(function(e){return e.kind===(t||"audio")}):[]}function w(e,t){!("srcObject"in t)&&"mozSrcObject"in t?t.mozSrcObject=e:t.srcObject=e}void 0!==(b=void 0===b&&"undefined"!=typeof webkitMediaStream?webkitMediaStream:b)&&void 0===b.prototype.stop&&(b.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})}),void 0!==S&&(S.invokeSaveAsDialog=y,S.getTracks=C,S.getSeekableBlob=function(e,o){if("undefined"==typeof EBML)throw new Error("Please link: https://www.webrtc-experiment.com/EBML.js");var n=new EBML.Reader,i=new EBML.Decoder,a=EBML.tools,t=new FileReader;t.onload=function(e){i.decode(this.result).forEach(function(e){n.read(e)}),n.stop();var t=a.makeMetadataSeekable(n.metadatas,n.duration,n.cues),r=this.result.slice(n.metadataSize),r=new Blob([t,r],{type:"video/webm"});o(r)},t.readAsArrayBuffer(e)},S.bytesToSize=v,S.isElectron=o);var _={};function l(){if(s||d||n)return!0;navigator.appVersion;var e,t=navigator.userAgent,r=""+parseFloat(navigator.appVersion),o=parseInt(navigator.appVersion,10);return(u||a)&&(e=t.indexOf("Chrome"),r=t.substring(e+7)),-1!==(e=(r=-1!==(e=r.indexOf(";"))?r.substring(0,e):r).indexOf(" "))&&(r=r.substring(0,e)),o=parseInt(""+r,10),isNaN(o)&&(r=""+parseFloat(navigator.appVersion),o=parseInt(navigator.appVersion,10)),49<=o}function R(r,o){var e,n=this;if(void 0===r)throw'First argument "MediaStream" is required.';if("undefined"==typeof MediaRecorder)throw"Your browser does not support the Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";"audio"===(o=o||{mimeType:"video/webm"}).type&&(C(r,"video").length&&C(r,"audio").length&&(navigator.mozGetUserMedia?(e=new b).addTrack(C(r,"audio")[0]):e=new b(C(r,"audio")),r=e),o.mimeType&&-1!==o.mimeType.toString().toLowerCase().indexOf("audio")||(o.mimeType=u?"audio/webm":"audio/ogg"),o.mimeType&&"audio/ogg"!==o.mimeType.toString().toLowerCase()&&navigator.mozGetUserMedia&&(o.mimeType="audio/ogg"));var i,a=[];function s(){n.timestamps.push((new Date).getTime()),"function"==typeof o.onTimeStamp&&o.onTimeStamp(n.timestamps[n.timestamps.length-1],n.timestamps)}function d(e){return i&&i.mimeType?i.mimeType:e.mimeType||"video/webm"}function t(){a=[],i=null,n.timestamps=[]}this.getArrayOfBlobs=function(){return a},this.record=function(){n.blob=null,n.clearRecordedData(),n.timestamps=[],c=[],a=[];var t=o;o.disableLogs||console.log("Passing following config over MediaRecorder API.",t),i=i&&null,u&&!l()&&(t="video/vp8"),"function"==typeof MediaRecorder.isTypeSupported&&t.mimeType&&(MediaRecorder.isTypeSupported(t.mimeType)||(o.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",t.mimeType),t.mimeType="audio"===o.type?"audio/webm":"video/webm"));try{i=new MediaRecorder(r,t),o.mimeType=t.mimeType}catch(e){i=new MediaRecorder(r)}t.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in i&&!1===i.canRecordMimeType(t.mimeType)&&(o.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",t.mimeType)),i.ondataavailable=function(e){e.data&&c.push("ondataavailable: "+v(e.data.size)),"number"!=typeof o.timeSlice?!e.data||!e.data.size||e.data.size<100||n.blob?n.recordingCallback&&(n.recordingCallback(new Blob([],{type:d(t)})),n.recordingCallback=null):(n.blob=o.getNativeBlob?e.data:new Blob([e.data],{type:d(t)}),n.recordingCallback&&(n.recordingCallback(n.blob),n.recordingCallback=null)):e.data&&e.data.size&&(a.push(e.data),s(),"function"==typeof o.ondataavailable&&(e=o.getNativeBlob?e.data:new Blob([e.data],{type:d(t)}),o.ondataavailable(e)))},i.onstart=function(){c.push("started")},i.onpause=function(){c.push("paused")},i.onresume=function(){c.push("resumed")},i.onstop=function(){c.push("stopped")},i.onerror=function(e){e&&(e.name||(e.name="UnknownError"),c.push("error: "+e),o.disableLogs||(-1!==e.name.toString().toLowerCase().indexOf("invalidstate")?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",e):-1!==e.name.toString().toLowerCase().indexOf("notsupported")?console.error("MIME type (",t.mimeType,") is not supported.",e):-1!==e.name.toString().toLowerCase().indexOf("security")?console.error("MediaRecorder security error",e):"OutOfMemory"===e.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"IllegalStreamModification"===e.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"OtherRecordingError"===e.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"GenericError"===e.name?console.error("The UA cannot provide the codec or recording option that has been requested.",e):console.error("MediaRecorder Error",e)),!n.manuallyStopped&&i&&"inactive"===i.state?(delete o.timeslice,i.start(6e5)):setTimeout(void 0,1e3),"inactive"!==i.state&&"stopped"!==i.state&&i.stop())},"number"==typeof o.timeSlice?(s(),i.start(o.timeSlice)):i.start(36e5),o.initCallback&&o.initCallback()},this.timestamps=[],this.stop=function(e){e=e||function(){},n.manuallyStopped=!0,i&&(this.recordingCallback=e,"recording"===i.state&&i.stop(),"number"==typeof o.timeSlice&&setTimeout(function(){n.blob=new Blob(a,{type:d(o)}),n.recordingCallback(n.blob)},100))},this.pause=function(){i&&"recording"===i.state&&i.pause()},this.resume=function(){i&&"paused"===i.state&&i.resume()},this.clearRecordedData=function(){i&&"recording"===i.state&&n.stop(t),t()},this.getInternalRecorder=function(){return i},this.blob=null,this.getState=function(){return i&&i.state||"inactive"};var c=[];this.getAllStates=function(){return c},void 0===o.checkForInactiveTracks&&(o.checkForInactiveTracks=!1),n=this,function e(){if(i&&!1!==o.checkForInactiveTracks)return!1===function(){if("active"in r){if(!r.active)return!1}else if("ended"in r&&r.ended)return!1;return!0}()?(o.disableLogs||console.log("MediaStream seems stopped."),void n.stop()):void setTimeout(e,1e3)}(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}function c(e,o){if(!C(e,"audio").length)throw"Your stream has no audio tracks.";var n,i=this,a=[],s=[],d=!1,c=0,u=2,l=(o=o||{}).desiredSampRate;function f(){if(!1===o.checkForInactiveTracks)return!0;if("active"in e){if(!e.active)return!1}else if("ended"in e&&e.ended)return!1;return!0}function t(e,t){function r(e,t){var r,o=e.numberOfAudioChannels,n=e.leftBuffers.slice(0),i=e.rightBuffers.slice(0),a=e.sampleRate,s=e.internalInterleavedLength,e=e.desiredSampRate;function d(e,t,r){var o=Math.round(e.length*(t/r)),n=[],i=Number((e.length-1)/(o-1));n[0]=e[0];for(var a,s=1;s<o-1;s++){var d=s*i,c=Number(Math.floor(d)).toFixed(),u=Number(Math.ceil(d)).toFixed();n[s]=(a=e[c])+(e[u]-a)*(d-c)}return n[o-1]=e[e.length-1],n}function c(e,t){for(var r=new Float64Array(t),o=0,n=e.length,i=0;i<n;i++){var a=e[i];r.set(a,o),o+=a.length}return r}function u(e,t,r){for(var o=r.length,n=0;n<o;n++)e.setUint8(t+n,r.charCodeAt(n))}2===o&&(n=c(n,s),i=c(i,s),e&&(n=d(n,e,a),i=d(i,e,a))),1===o&&(n=c(n,s),e&&(n=d(n,e,a))),e&&(a=e),2===o&&(r=function(e,t){for(var r=e.length+t.length,o=new Float64Array(r),n=0,i=0;i<r;)o[i++]=e[n],o[i++]=t[n],n++;return o}(n,i));var i=(r=1===o?n:r).length,n=new ArrayBuffer(44+2*i),l=new DataView(n);u(l,0,"RIFF"),l.setUint32(4,36+2*i,!0),u(l,8,"WAVE"),u(l,12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,1,!0),l.setUint16(22,o,!0),l.setUint32(24,a,!0),l.setUint32(28,a*o*2,!0),l.setUint16(32,2*o,!0),l.setUint16(34,16,!0),u(l,36,"data"),l.setUint32(40,2*i,!0);for(var f=i,h=44,m=0;m<f;m++)l.setInt16(h,32767*r[m],!0),h+=2;if(t)return t({buffer:n,view:l});postMessage({buffer:n,view:l})}var o,n,i;e.noWorker?r(e,function(e){t(e.buffer,e.view)}):(n=r,i=T.createObjectURL(new Blob([n.toString(),";this.onmessage =  function (eee) {"+n.name+"(eee.data);}"],{type:"application/javascript"})),(n=new Worker(i)).workerURL=i,(o=n).onmessage=function(e){t(e.data.buffer,e.data.view),T.revokeObjectURL(o.workerURL),o.terminate()},o.postMessage(e))}!0===o.leftChannel&&(u=1),(!(u=1===o.numberOfAudioChannels?1:u)||u<1)&&(u=2),o.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+u),void 0===o.checkForInactiveTracks&&(o.checkForInactiveTracks=!0),this.record=function(){if(!1===f())throw"Please make sure MediaStream is active.";v(),w=b=!1,d=!0,void 0!==o.timeSlice&&R()},this.stop=function(r){r=r||function(){},d=!1,t({desiredSampRate:l,sampleRate:g,numberOfAudioChannels:u,internalInterleavedLength:c,leftBuffers:a,rightBuffers:1===u?[]:s,noWorker:o.noWorker},function(e,t){i.blob=new Blob([t],{type:"audio/wav"}),i.buffer=new ArrayBuffer(t.buffer.byteLength),i.view=t,i.sampleRate=l||g,i.bufferSize=p,i.length=c,w=!1,r&&r(i.blob)})},(S.Storage=void 0===S.Storage?{AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext}:S.Storage).AudioContextConstructor&&"closed"!==S.Storage.AudioContextConstructor.state||(S.Storage.AudioContextConstructor=new S.Storage.AudioContext);var r=S.Storage.AudioContextConstructor,h=r.createMediaStreamSource(e),m=[0,256,512,1024,2048,4096,8192,16384],p=void 0===o.bufferSize?4096:o.bufferSize;if(-1===m.indexOf(p)&&(o.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(m,null,"\t"))),r.createJavaScriptNode)n=r.createJavaScriptNode(p,u,u);else{if(!r.createScriptProcessor)throw"WebAudio API has no support on this browser.";n=r.createScriptProcessor(p,u,u)}h.connect(n),o.bufferSize||(p=n.bufferSize);var g=void 0!==o.sampleRate?o.sampleRate:r.sampleRate||44100;(g<22050||96e3<g)&&(o.disableLogs||console.log("sample-rate must be under range 22050 and 96000.")),o.disableLogs||o.desiredSampRate&&console.log("Desired sample-rate: "+o.desiredSampRate);var b=!1;function v(){a=[],c=0,b=d=w=!(s=[]),r=null,i.leftchannel=a,i.rightchannel=s,i.numberOfAudioChannels=u,i.desiredSampRate=l,i.sampleRate=g,i.recordingLength=c,_={left:[],right:[],recordingLength:0}}function y(){n&&(n.onaudioprocess=null,n.disconnect(),n=null),h&&(h.disconnect(),h=null),v()}this.pause=function(){b=!0},this.resume=function(){if(!1===f())throw"Please make sure MediaStream is active.";if(!d)return o.disableLogs||console.log("Seems recording has been restarted."),void this.record();b=!1},this.clearRecordedData=function(){o.checkForInactiveTracks=!1,d&&this.stop(y),y()},this.name="StereoAudioRecorder";var w=!(this.toString=function(){return this.name});n.onaudioprocess=function(e){var t,r;b||(!1===f()&&(o.disableLogs||console.log("MediaStream seems stopped."),n.disconnect(),d=!1),d?(w||(w=!0,o.onAudioProcessStarted&&o.onAudioProcessStarted(),o.initCallback&&o.initCallback()),t=e.inputBuffer.getChannelData(0),t=new Float32Array(t),a.push(t),2===u&&(r=e.inputBuffer.getChannelData(1),r=new Float32Array(r),s.push(r)),c+=p,i.recordingLength=c,void 0!==o.timeSlice&&(_.recordingLength+=p,_.left.push(t),2===u&&_.right.push(r))):h&&(h.disconnect(),h=null))},r.createMediaStreamDestination?n.connect(r.createMediaStreamDestination()):n.connect(r.destination),this.leftchannel=a,this.rightchannel=s,this.numberOfAudioChannels=u,this.desiredSampRate=l,this.sampleRate=g,i.recordingLength=c;var _={left:[],right:[],recordingLength:0};function R(){d&&"function"==typeof o.ondataavailable&&void 0!==o.timeSlice&&(_.left.length?(t({desiredSampRate:l,sampleRate:g,numberOfAudioChannels:u,internalInterleavedLength:_.recordingLength,leftBuffers:_.left,rightBuffers:1===u?[]:_.right},function(e,t){t=new Blob([t],{type:"audio/wav"}),o.ondataavailable(t),setTimeout(R,o.timeSlice)}),_={left:[],right:[],recordingLength:0}):setTimeout(R,o.timeSlice))}}function f(n,i){if("undefined"==typeof html2canvas)throw"Please link: https://www.webrtc-experiment.com/screenshot.js";(i=i||{}).frameInterval||(i.frameInterval=10);var o=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){e in document.createElement("canvas")&&(o=!0)});var r,a,s,e=!(!window.webkitRTCPeerConnection&&!window.webkitGetUserMedia||!window.chrome),t=50,d=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(e&&d&&d[2]&&(t=parseInt(d[2],10)),e&&t<52&&(o=!1),o=!i.useWhammyRecorder&&o)if(i.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),n instanceof HTMLCanvasElement)r=n;else{if(!(n instanceof CanvasRenderingContext2D))throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";r=n.canvas}else navigator.mozGetUserMedia&&(i.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));this.record=function(){if(s=!0,o&&!i.useWhammyRecorder){var e;"captureStream"in r?e=r.captureStream(25):"mozCaptureStream"in r?e=r.mozCaptureStream(25):"webkitCaptureStream"in r&&(e=r.webkitCaptureStream(25));try{var t=new b;t.addTrack(C(e,"video")[0]),e=t}catch(e){}if(!e)throw"captureStream API are NOT available.";(a=new R(e,{mimeType:i.mimeType||"video/webm"})).record()}else h.frames=[],f=(new Date).getTime(),l();i.initCallback&&i.initCallback()},this.getWebPImages=function(e){var o;"canvas"===n.nodeName.toLowerCase()&&(o=h.frames.length,h.frames.forEach(function(e,t){var r=o-t;i.disableLogs||console.log(r+"/"+o+" frames remaining"),i.onEncodingCallback&&i.onEncodingCallback(r,o),e=e.image.toDataURL("image/webp",1),h.frames[t].image=e}),i.disableLogs||console.log("Generating WebM")),e()};var c=!(this.stop=function(t){s=!1;var r=this;o&&a?a.stop(t):this.getWebPImages(function(){h.compile(function(e){i.disableLogs||console.log("Recording finished!"),r.blob=e,r.blob.forEach&&(r.blob=new Blob([],{type:"video/webm"})),t&&t(r.blob),h.frames=[]})})});function u(){h.frames=[],c=s=!1}function l(){if(c)return f=(new Date).getTime(),setTimeout(l,500);if("canvas"===n.nodeName.toLowerCase()){var e=(new Date).getTime()-f;return f=(new Date).getTime(),h.frames.push({image:(r=(t=document.createElement("canvas")).getContext("2d"),t.width=n.width,t.height=n.height,r.drawImage(n,0,0),t),duration:e}),void(s&&setTimeout(l,i.frameInterval))}var t,r;html2canvas(n,{grabMouse:void 0===i.showMousePointer||i.showMousePointer,onrendered:function(e){var t=(new Date).getTime()-f;if(!t)return setTimeout(l,i.frameInterval);f=(new Date).getTime(),h.frames.push({image:e.toDataURL("image/webp",1),duration:t}),s&&setTimeout(l,i.frameInterval)}})}this.pause=function(){c=!0,a instanceof R&&a.pause()},this.resume=function(){c=!1,a instanceof R?a.resume():s||this.record()},this.clearRecordedData=function(){s&&this.stop(u),u()},this.name="CanvasRecorder",this.toString=function(){return this.name};var f=(new Date).getTime(),h=new P.Video(100)}function k(e,o){function r(e){e=void 0!==e?e:10;var t=(new Date).getTime()-s;return t?i?(s=(new Date).getTime(),setTimeout(r,100)):(s=(new Date).getTime(),a.paused&&a.play(),c.drawImage(a,0,0,b.width,b.height),d.frames.push({duration:t,image:b.toDataURL("image/webp")}),void(n||setTimeout(r,e,e))):setTimeout(r,e,e)}(o=o||{}).frameInterval||(o.frameInterval=10),o.disableLogs||console.log("Using frames-interval:",o.frameInterval);var n=!(this.record=function(){o.width||(o.width=320),o.height||(o.height=240),o.video||(o.video={width:o.width,height:o.height}),o.canvas||(o.canvas={width:o.width,height:o.height}),b.width=o.canvas.width||320,b.height=o.canvas.height||240,c=b.getContext("2d"),o.video&&o.video instanceof HTMLVideoElement?(a=o.video.cloneNode(),o.initCallback&&o.initCallback()):(a=document.createElement("video"),w(e,a),a.onloadedmetadata=function(){o.initCallback&&o.initCallback()},a.width=o.video.width,a.height=o.video.height),a.muted=!0,a.play(),s=(new Date).getTime(),d=new P.Video,o.disableLogs||(console.log("canvas resolutions",b.width,"*",b.height),console.log("video width/height",a.width||b.width,"*",a.height||b.height)),r(o.frameInterval)}),i=!(this.stop=function(t){t=t||function(){},n=!0;var r=this;setTimeout(function(){!function(r,e,t,o,n){var i=document.createElement("canvas");i.width=b.width,i.height=b.height;var a,u=i.getContext("2d"),l=[],f=-1===e,s=e&&0<e&&e<=r.length?e:r.length,h=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),m=t&&0<=t&&t<=1?t:0,p=o&&0<=o&&o<=1?o:0,g=!1,d=-1,c=(a={length:s,functionToLoop:function(e,t){function i(){!g&&d-a<=d*p||(f&&(g=!0),l.push(r[t])),e()}var a,s,d,c;g?i():((c=new Image).onload=function(){u.drawImage(c,0,0,b.width,b.height);var e=u.getImageData(0,0,b.width,b.height);a=0,s=e.data.length,d=e.data.length/4;for(var t=0;t<s;t+=4){var r=e.data[t],o=e.data[t+1],n=e.data[t+2];Math.sqrt(Math.pow(+r,2)+Math.pow(+o,2)+Math.pow(+n,2))<=h*m&&a++}i()},c.src=r[t].image)},callback:function(){(l=l.concat(r.slice(s))).length<=0&&l.push(r[r.length-1]),n(l)}}).length;(function e(){++d!==c?setTimeout(function(){a.functionToLoop(e,d)},1):a.callback()})()}(d.frames,-1,null,null,function(e){d.frames=e,o.advertisement&&o.advertisement.length&&(d.frames=o.advertisement.concat(d.frames)),d.compile(function(e){r.blob=e,r.blob.forEach&&(r.blob=new Blob([],{type:"video/webm"})),t&&t(r.blob)})})},10)});function t(){d.frames=[],i=!(n=!0)}this.pause=function(){i=!0},this.resume=function(){i=!1,n&&this.record()},this.clearRecordedData=function(){n||this.stop(t),t()},this.name="WhammyRecorder",this.toString=function(){return this.name};var a,s,d,b=document.createElement("canvas"),c=b.getContext("2d")}void 0!==r?_.AudioContext=r:"undefined"!=typeof webkitAudioContext&&(_.AudioContext=webkitAudioContext),void 0!==S&&(S.Storage=_),void 0!==S&&(S.MediaStreamRecorder=R),void 0!==S&&(S.StereoAudioRecorder=c),void 0!==S&&(S.CanvasRecorder=f),void 0!==S&&(S.WhammyRecorder=k);var P=(E.prototype.add=function(e,t){if("toDataURL"in(e="canvas"in e?e.canvas:e)&&(e=e.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},E.prototype.compile=function(t){var e,r=(r=A,e=T.createObjectURL(new Blob([r.toString(),"this.onmessage =  function (eee) {"+r.name+"(eee.data);}"],{type:"application/javascript"})),r=new Worker(e),T.revokeObjectURL(e),r);r.onmessage=function(e){e.data.error?console.error(e.data.error):t(e.data)},r.postMessage(this.frames)},{Video:E});function E(e){this.frames=[],this.duration=e||1,this.quality=.8}function A(e){function c(e){var t=[];e=(e.length%8?new Array(9-e.length%8).join("0"):"")+e;for(var r=0;r<e.length;r+=8)t.push(parseInt(e.substr(r,8),2));return new Uint8Array(t)}e=new function(e){var t=function(e){if(e[0]){for(var t=e[0].width,r=e[0].height,o=e[0].duration,n=1;n<e.length;n++)o+=e[n].duration;return{duration:o,width:t,height:r}}postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."})}(e);if(!t)return[];for(var r,o=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:(r=t.duration,[].slice.call(new Uint8Array(new Float64Array([r]).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join("")),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:t.width,id:176},{data:t.height,id:186}]}]}]}]}],n=0,i=0;n<e.length;){for(var a=[],s=0;a.push(e[n]),s+=e[n].duration,++n<e.length&&s<3e4;);var d={id:524531317,data:function(r){return[{data:i,id:231}].concat(a.map(function(e){var t=function(e){var t=0;if(e.keyframe&&(t|=128),e.invisible&&(t|=8),e.lacing&&(t|=e.lacing<<1),e.discardable&&(t|=1),127<e.trackNum)throw"TrackNumber > 127 not supported";return[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map(function(e){return String.fromCharCode(e)}).join("")+e.frame}({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(r)});return r+=e.duration,{data:t,id:163}}))}(0)};o[1].data.push(d),i+=s}return function e(t){for(var r=[],o=0;o<t.length;o++){var n=t[o].data,i=(n="string"==typeof(n="number"==typeof(n="object"==$t(n)?e(n):n)?c(n.toString(2)):n)?new Uint8Array(n.split("").map(function(e){return e.charCodeAt(0)})):n).size||n.byteLength||n.length,a=Math.ceil(Math.ceil(Math.log(i)/Math.log(2))/8),i=i.toString(2),i=new Array(7*a+7+1-i.length).join("0")+i,i=new Array(a).join("0")+"1"+i;r.push(function(e){for(var t=[];0<e;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}(t[o].id)),r.push(c(i)),r.push(n)}return new Blob(r,{type:"video/webm"})}(o)}(e.map(function(e){var t=function(e){for(var t=e.RIFF[0].WEBP[0],r=t.indexOf("*"),o=0,n=[];o<4;o++)n[o]=t.charCodeAt(r+3+o);return{width:16383&(n[1]<<8|n[0]),height:16383&(n[3]<<8|n[2]),data:t,riff:e}}(function e(t){for(var r=0,o={};r<t.length;){var n=t.substr(r,4),i=(a=r,parseInt(t.substr(a+4,4).split("").map(function(e){return e=e.charCodeAt(0).toString(2),new Array(8-e.length+1).join("0")+e}).join(""),2)),a=t.substr(r+4+4,i);r+=8+i,o[n]=o[n]||[],"RIFF"===n||"LIST"===n?o[n].push(e(a)):o[n].push(a)}return o}(atob(e.image.slice(23))));return t.duration=e.duration,t})),postMessage(e)}void 0!==S&&(S.Whammy=P);var j={init:function(){var e,r,t,o=this;function n(e){e.createObjectStore(o.dataStoreName)}function i(){var e=r.transaction([o.dataStoreName],"readwrite");function t(t){e.objectStore(o.dataStoreName).get(t).onsuccess=function(e){o.callback&&o.callback(e.target.result,t)}}o.videoBlob&&e.objectStore(o.dataStoreName).put(o.videoBlob,"videoBlob"),o.gifBlob&&e.objectStore(o.dataStoreName).put(o.gifBlob,"gifBlob"),o.audioBlob&&e.objectStore(o.dataStoreName).put(o.audioBlob,"audioBlob"),t("audioBlob"),t("videoBlob"),t("gifBlob")}"undefined"!=typeof indexedDB&&void 0!==indexedDB.open?(e=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),(t=indexedDB.open(e,1)).onerror=o.onError,t.onsuccess=function(){(r=t.result).onerror=o.onError,r.setVersion&&1!==r.version?r.setVersion(1).onsuccess=function(){n(r),i()}:i()},t.onupgradeneeded=function(e){n(e.target.result)}):console.error("IndexedDB API are not available in this browser.")},Fetch:function(e){return this.callback=e,this.init(),this},Store:function(e){return this.audioBlob=e.audioBlob,this.videoBlob=e.videoBlob,this.gifBlob=e.gifBlob,this.init(),this},onError:function(e){console.error(JSON.stringify(e,null,"\t"))},dataStoreName:"recordRTC",dbName:null};function O(e,r){var t;"undefined"==typeof GIFEncoder&&((t=document.createElement("script")).src="https://www.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(t)),r=r||{};var o=e instanceof CanvasRenderingContext2D||e instanceof HTMLCanvasElement;this.record=function(){"undefined"!=typeof GIFEncoder&&d?(o||(r.width||(r.width=s.offsetWidth||320),r.height||(r.height=s.offsetHeight||240),r.video||(r.video={width:r.width,height:r.height}),r.canvas||(r.canvas={width:r.width,height:r.height}),i.width=r.canvas.width||320,i.height=r.canvas.height||240,s.width=r.video.width||320,s.height=r.video.height||240),(u=new GIFEncoder).setRepeat(0),u.setDelay(r.frameRate||200),u.setQuality(r.quality||10),u.start(),"function"==typeof r.onGifRecordingStarted&&r.onGifRecordingStarted(),l=h(function e(t){if(!0!==f.clearedRecordedData){if(n)return setTimeout(function(){e(t)},100);l=h(e),t-c<90||(!o&&s.paused&&s.play(),o||a.drawImage(s,0,0,i.width,i.height),r.onGifPreview&&r.onGifPreview(i.toDataURL("image/png")),u.addFrame(a),c=t)}}),r.initCallback&&r.initCallback()):setTimeout(f.record,1e3)};var n=!(this.stop=function(e){e=e||function(){},l&&g(l),this.blob=new Blob([new Uint8Array(u.stream().bin)],{type:"image/gif"}),e(this.blob),u.stream().bin=[]});this.pause=function(){n=!0},this.resume=function(){n=!1},this.clearRecordedData=function(){f.clearedRecordedData=!0,u&&(u.stream().bin=[])},this.name="GifRecorder",this.toString=function(){return this.name};var i=document.createElement("canvas"),a=i.getContext("2d");o&&(e instanceof CanvasRenderingContext2D?i=(a=e).canvas:e instanceof HTMLCanvasElement&&(a=e.getContext("2d"),i=e));var s,d=!0;o||((s=document.createElement("video")).muted=!0,s.autoplay=!0,s.playsInline=!0,d=!1,s.onloadedmetadata=function(){d=!0},w(e,s),s.play());var c,u,l=null,f=this}function M(o,n){n=n||"multi-streams-mixer";var i=[],a=!1,s=document.createElement("canvas"),d=s.getContext("2d");s.style.opacity=0,s.style.position="absolute",s.style.zIndex=-1,s.style.top="-1000em",s.style.left="-1000em",s.className=n,(document.body||document.documentElement).appendChild(s),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0;var c=this,e=window.AudioContext;void 0===e&&("undefined"!=typeof webkitAudioContext&&(e=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(e=mozAudioContext)),window.URL,"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var u=window.MediaStream;void 0!==(u=void 0===u&&"undefined"!=typeof webkitMediaStream?webkitMediaStream:u)&&void 0===u.prototype.stop&&(u.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})});var r={};function l(){var e,t,r;a||(e=i.length,t=!1,r=[],i.forEach(function(e){e.stream||(e.stream={}),e.stream.fullcanvas?t=e:r.push(e)}),t?(s.width=t.stream.width,s.height=t.stream.height):r.length?(s.width=1<e?2*r[0].width:r[0].width,s.height=r[0].height*(9!==e&&10!==e?7!==e&&8!==e?5!==e&&6!==e?3!==e&&4!==e?1:2:3:4:5)):(s.width=c.width||360,s.height=c.height||240),t&&t instanceof HTMLVideoElement&&f(t),r.forEach(function(e,t){f(e,t)}),setTimeout(l,c.frameInterval))}function f(e,t){var r,o,n,i;a||(o=r=0,n=e.width,i=e.height,1===t&&(r=e.width),2===t&&(o=e.height),3===t&&(r=e.width,o=e.height),4===t&&(o=2*e.height),5===t&&(r=e.width,o=2*e.height),6===t&&(o=3*e.height),7===t&&(r=e.width,o=3*e.height),void 0!==e.stream.left&&(r=e.stream.left),void 0!==e.stream.top&&(o=e.stream.top),void 0!==e.stream.width&&(n=e.stream.width),void 0!==e.stream.height&&(i=e.stream.height),d.drawImage(e,r,o,n,i),"function"==typeof e.stream.onRender&&e.stream.onRender(d,r,o,n,i,t))}function h(e){var t,r=document.createElement("video"),o=e;return!("srcObject"in(t=r))&&"mozSrcObject"in t?t.mozSrcObject=o:t.srcObject=o,r.className=n,r.muted=!0,r.volume=0,r.width=e.width||c.width||360,r.height=e.height||c.height||240,r.play(),r}function m(e){i=[],(e=e||o).forEach(function(e){var t;e.getTracks().filter(function(e){return"video"===e.kind}).length&&((t=h(e)).stream=e,i.push(t))})}void 0!==e?r.AudioContext=e:"undefined"!=typeof webkitAudioContext&&(r.AudioContext=webkitAudioContext),this.startDrawingFrames=function(){l()},this.appendStreams=function(e){if(!e)throw"First parameter is required.";(e=e instanceof Array?e:[e]).forEach(function(e){var t,r=new u;e.getTracks().filter(function(e){return"video"===e.kind}).length&&((t=h(e)).stream=e,i.push(t),r.addTrack(e.getTracks().filter(function(e){return"video"===e.kind})[0])),e.getTracks().filter(function(e){return"audio"===e.kind}).length&&(e=c.audioContext.createMediaStreamSource(e),c.audioDestination=c.audioContext.createMediaStreamDestination(),e.connect(c.audioDestination),r.addTrack(c.audioDestination.stream.getTracks().filter(function(e){return"audio"===e.kind})[0])),o.push(r)})},this.releaseStreams=function(){i=[],a=!0,c.gainNode&&(c.gainNode.disconnect(),c.gainNode=null),c.audioSources.length&&(c.audioSources.forEach(function(e){e.disconnect()}),c.audioSources=[]),c.audioDestination&&(c.audioDestination.disconnect(),c.audioDestination=null),c.audioContext&&c.audioContext.close(),c.audioContext=null,d.clearRect(0,0,s.width,s.height),s.stream&&(s.stream.stop(),s.stream=null)},this.resetVideoStreams=function(e){m(e=!e||e instanceof Array?e:[e])},this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=function(){a=!1;var t=function(){var e;m(),"captureStream"in s?e=s.captureStream():"mozCaptureStream"in s?e=s.mozCaptureStream():c.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var t=new u;return e.getTracks().filter(function(e){return"video"===e.kind}).forEach(function(e){t.addTrack(e)}),s.stream=t}(),e=function(){r.AudioContextConstructor||(r.AudioContextConstructor=new r.AudioContext),c.audioContext=r.AudioContextConstructor,c.audioSources=[],!0===c.useGainNode&&(c.gainNode=c.audioContext.createGain(),c.gainNode.connect(c.audioContext.destination),c.gainNode.gain.value=0);var t=0;if(o.forEach(function(e){e.getTracks().filter(function(e){return"audio"===e.kind}).length&&(t++,e=c.audioContext.createMediaStreamSource(e),!0===c.useGainNode&&e.connect(c.gainNode),c.audioSources.push(e))}),t)return c.audioDestination=c.audioContext.createMediaStreamDestination(),c.audioSources.forEach(function(e){e.connect(c.audioDestination)}),c.audioDestination.stream}();return e&&e.getTracks().filter(function(e){return"audio"===e.kind}).forEach(function(e){t.addTrack(e)}),o.forEach(function(e){e.fullcanvas}),t}}function L(r,o){r=r||[];var n,i,a=this;(o=o||{elementClass:"multi-streams-mixer",mimeType:"video/webm",video:{width:360,height:240}}).frameInterval||(o.frameInterval=10),o.video||(o.video={}),o.video.width||(o.video.width=360),o.video.height||(o.video.height=240),this.record=function(){var t;n=new M(r,o.elementClass||"multi-streams-mixer"),t=[],r.forEach(function(e){C(e,"video").forEach(function(e){t.push(e)})}),t.length&&(n.frameInterval=o.frameInterval||10,n.width=o.video.width||360,n.height=o.video.height||240,n.startDrawingFrames()),o.previewStream&&"function"==typeof o.previewStream&&o.previewStream(n.getMixedStream()),(i=new R(n.getMixedStream(),o)).record()},this.stop=function(t){i&&i.stop(function(e){a.blob=e,t(e),a.clearRecordedData()})},this.pause=function(){i&&i.pause()},this.resume=function(){i&&i.resume()},this.clearRecordedData=function(){i&&(i.clearRecordedData(),i=null),n&&(n.releaseStreams(),n=null)},this.addStreams=function(e){if(!e)throw"First parameter is required.";e instanceof Array||(e=[e]),r.concat(e),i&&n&&(n.appendStreams(e),o.previewStream&&"function"==typeof o.previewStream&&o.previewStream(n.getMixedStream()))},this.resetVideoStreams=function(e){n&&(!e||e instanceof Array||(e=[e]),n.resetVideoStreams(e))},this.getMixer=function(){return n},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}function B(s,d){var c,o;"undefined"!=typeof ReadableStream&&"undefined"!=typeof WritableStream||console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),(d=d||{}).width=d.width||640,d.height=d.height||480,d.frameRate=d.frameRate||30,d.bitrate=d.bitrate||1200,d.realtime=d.realtime||!0;var n,i=!1;this.record=function(){n=!(a=[]),this.blob=null,function t(r,e){if(console.log("🚀 ~ file: CWMediaCollector.js ~ self._opt.options.workerPath",d,d.workerPath),!d.workerPath&&!e)return c=!1,fetch("https://cdn.jsdelivr.net/npm/webm-wasm@0.4.1/dist/webm-worker.js").then(function(e){console.log("r=",e),e.ok?(console.log("🚀 ~ file: CWMediaCollector.js ~","webm-worker.js loading success",e),e.arrayBuffer().then(function(e){t(r,e)})):(console.log("🚀 ~ file: CWMediaCollector.js ~ ","webm-worker.js loading failed",e),d.JSLoadFailedCallBack())}).catch(function(e){console.log("🚀 ~ file: CWMediaCollector.js ~ ","webm-worker.js loading failed",e),d.JSLoadFailedCallBack()}),0;console.log("🚀 ~ file: CWMediaCollector.js  ~ ","load local file webm-worker.js"),!d.workerPath&&e instanceof ArrayBuffer&&(e=new Blob([e],{type:"text/javascript"}),d.workerPath=T.createObjectURL(e)),d.workerPath||console.error("workerPath parameter is missing."),(o=new Worker(d.workerPath)).postMessage(d.webAssemblyPath||"https://cdn.jsdelivr.net/npm/webm-wasm@0.4.1/dist/webm-wasm.wasm"),o.addEventListener("message",function(e){i=!0,"READY"===e.data?(o.postMessage({width:d.width,height:d.height,bitrate:d.bitrate||1200,timebaseDen:d.frameRate||30,realtime:d.realtime}),new ReadableStream({start:function(o){var n=document.createElement("canvas"),i=document.createElement("video"),a=!0;i.srcObject=s,i.muted=!0,i.height=d.height,i.width=d.width,i.volume=0,setTimeout(function(){n.width=d.width,n.height=d.height;var e=n.getContext("2d"),t=1e3/d.frameRate,r=setInterval(function(){if(c&&(clearInterval(r),o.close()),a&&(a=!1,d.onVideoProcessStarted&&d.onVideoProcessStarted()),e.drawImage(i,0,0),o._controlledReadableStream&&"closed"!==o._controlledReadableStream.state)try{o.enqueue(e.getImageData(0,0,d.width,d.height))}catch(e){}},t)},0),i.play()}}).pipeTo(new WritableStream({write:function(e){c?console.error("Got image, but recorder is finished!"):o.postMessage(e.data.buffer,[e.data.buffer])}}))):e.data&&(n||a.push(e.data))})}(s),"function"==typeof d.initCallback&&d.initCallback()},this.pause=function(){n=!0},this.resume=function(){n=!1};var a=[];this.stop=function(e){c=!0;var t,r=this;i?(t=function(){r.blob=new Blob(a,{type:"video/webm"}),e(r.blob)},o?(o.addEventListener("message",function(e){null!==e.data&&"READY"!==e.data||(o.terminate(),o=null,t())}),o.postMessage(null)):t()):setTimeout(function(){r.blob=new Blob(a,{type:"video/webm"}),o&&(o.terminate(),o=null),e(r.blob)},3e3)},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){n=!(a=[]),this.blob=null},this.blob=null}void 0!==S&&(S.DiskStorage=j),void 0!==S&&(S.GifRecorder=O),void 0===S&&("undefined"!=typeof module&&(module.exports=M),"function"==typeof define&&define.amd&&define("MultiStreamsMixer",[],function(){return M})),void 0!==S&&(S.MultiStreamRecorder=L),void 0!==S&&(S.RecordRTCPromisesHandler=function(e,t){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(void 0===e)throw'First argument "MediaStream" is required.';var o=this;o.recordRTC=new S(e,t),this.startRecording=function(){return new Promise(function(e,t){try{o.recordRTC.startRecording(),e()}catch(e){t(e)}})},this.stopRecording=function(){return new Promise(function(t,r){try{o.recordRTC.stopRecording(function(e){o.blob=o.recordRTC.getBlob(),o.blob&&o.blob.size?t(e):r("Empty blob.",o.blob)})}catch(e){r(e)}})},this.pauseRecording=function(){return new Promise(function(e,t){try{o.recordRTC.pauseRecording(),e()}catch(e){t(e)}})},this.resumeRecording=function(){return new Promise(function(e,t){try{o.recordRTC.resumeRecording(),e()}catch(e){t(e)}})},this.getDataURL=function(e){return new Promise(function(t,r){try{o.recordRTC.getDataURL(function(e){t(e)})}catch(e){r(e)}})},this.getBlob=function(){return new Promise(function(e,t){try{e(o.recordRTC.getBlob())}catch(e){t(e)}})},this.getInternalRecorder=function(){return new Promise(function(e,t){try{e(o.recordRTC.getInternalRecorder())}catch(e){t(e)}})},this.reset=function(){return new Promise(function(e,t){try{e(o.recordRTC.reset())}catch(e){t(e)}})},this.destroy=function(){return new Promise(function(e,t){try{e(o.recordRTC.destroy())}catch(e){t(e)}})},this.getState=function(){return new Promise(function(e,t){try{e(o.recordRTC.getState())}catch(e){t(e)}})},this.blob=null,this.version="5.6.2"}),void 0!==S&&(S.WebAssemblyRecorder=B);var q=[{phoneBrand:"mi 9",system:"android",version:9},{phoneBrand:"OPPO",system:"android",version:10}],I={initElEmpty:{code:10001,message:"el 不能为空"},initFailed:{code:10002,message:"请使用safari打开"},recorderEmpty:{code:10003,message:"没有录制视频"},startCollectFailed:{code:10004,message:"请勿重复开启视频录制"},needOpenCamera:{code:10005,message:"请先开始录制"},openCameraFailed:{code:10006,message:"摄像头打开失败"},uploadFailed:{code:10007,message:"未上传文件"},JSLoadFailed:{code:10008,message:"依赖文件加载失败"},recordingEnd:{code:2e4,message:"录制结束"},recorderType1:{code:20001,message:"打开页面内部摄像头录制"},recorderType2:{code:20002,message:"打开原生相机录制"},openCameraSuccess:{code:20003,message:"摄像头打开成功"}},D={url:"",el:null,time:5,mode:1,options:{width:480,height:600,frameRate:20},onInitSuccess:function(){},onSuccess:function(){},onError:function(){}};return console.log("CWMediaCollector SDK version:",e),function(){function r(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var t=U(U({},D),e);if(e.width&&(t.options.width=e.width),e.height&&(t.options.height=e.height),!(this._opt=t).el)return console.error("el 不能为空"),void(this._opt.onError&&this._opt.onError(U({},I.initElEmpty)));t.el.style.position="relative",t.el.style.zIndex=0,this._renderTimer=null,this._clockTimer=null,this._clock=null,this._recorderTimer=null,this._mediaStreamTrack=null,this._blob=null,this._runEnvironment=this.getRunEnvironment(),this._isIosWeixin=!1,this._isCanRun=this.isCanRun(),this.status=0,this.recordingType=I.recorderType1.code,this._callback=function(){},console.log("opt===",t),this._isCanRun&&this.init()}var e,t,o;return e=r,(t=[{key:"isCanRun",value:function(){return!(this._runEnvironment.isIos&&this._runEnvironment.isWeixin&&(this._isIosWeixin=!0,2===this._opt.mode&&this._opt.onError&&(this._opt.onError(U({},I.initFailed)),1)))}},{key:"checkStatus",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"start",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return"start"===e?1===this.status?(t&&t(U({},I.startCollectFailed)),!1):0===this.status||void 0:"stop"===e&&this._opt.onError?0===this.status?(clearInterval(this._clockTimer),document.getElementById("countdown").innerHTML="5",this._opt.onError(U({},I.needOpenCamera)),!1):1===this.status||void 0:void 0}},{key:"init",value:function(){var e=this,t=this._opt.webmWorkerPath,r=this._opt.el,o=0<r.clientWidth?r.clientWidth:300,n=0<r.clientHeight?r.clientHeight:300,o=this._createCanvas(o,n);this._canvas=o,this._resize(),r.appendChild(this._canvas);var i={};if(this._runEnvironment.isIos)i={checkForInactiveTracks:!1,disableLogs:!1,getNativeBlob:!1,ignoreMutedMedia:!1,mimeType:"video/webm",type:"video",recorderType:R};else{var a=document.getElementsByTagName("script"),n=a.length,s="webm-worker.js",d=(o=window.location.href).substring(0,o.lastIndexOf("/"));if(console.log("currentUrlPath=",d),window.location.host&&1<=n)for(var c=0;c<a.length;c++){var u=a[c].src,l=u.substring(u.lastIndexOf("/")+1);if(u&&"CWMediaCollector.js"===l){if(-1<u.indexOf(d)){s="."+u.substring(d.length,u.lastIndexOf("/")+1)+"webm-worker.js",console.log("workerPath----",s);break}s=u.substr(0,u.lastIndexOf("/")+1)+"webm-worker.js";break}s=""}else s="";console.log("workerPath=",s),i={recorderType:B,JSLoadFailedCallBack:function(){e._opt.onError(U({},I.JSLoadFailed)),e.stopCollect(!1)},workerPath:t||s}}this._opt.options=U(U({},this._opt.options),i),t=this._createInput(),r.appendChild(t),this._input=t,this.getRecordType()}},{key:"_resize",value:function(){this._opt.el;var e=this._canvas;e.width=50,e.height=30,e.style="position: absolute;",e.style.left="10px",e.style.top=0}},{key:"_createCanvas",value:function(e,t){this._deleteElement("collector-time-canvas");var r=document.createElement("canvas");return r.id="collector-time-canvas",r.width=e,r.height=t,r.style.position="absolute",r.style.left="10px",r.style.top=0,r.style.zIndex=1,r}},{key:"_createVideo",value:function(){this._deleteElement("video");var e=(t=this._opt.el).clientWidth,t=t.clientHeight,r=document.createElement("video");return r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",!0),r.width=e,r.height=t,r}},{key:"_createInput",value:function(){var r=this;this._deleteElement("collector-video-input");var o=document.createElement("input");return o.id="collector-video-input",o.type="file",o.accept="video/*",o.capture="camera",o.style.display="none",o.onclick=function(){document.body.onfocus=function(){var t=setTimeout(function(){var e;o.value.length?(e=o.files[0],r._blob=e,r._opt.onSuccess(U(U({},I.recordingEnd),{},{data:r._blob})),clearTimeout(t)):r._opt.onError(U({},I.uploadFailed)),document.body.onfocus=null},500)}},o}},{key:"_deleteElement",value:function(e){e=document.getElementById(e);e&&e.parentNode.removeChild(e)}},{key:"getRecordType",value:function(){this.isSupportUserMedia()&&this.isSupportRecord()?(this.recordingType=I.recorderType1.code,this._opt.onInitSuccess(U({},I.recorderType1))):(this.recordingType=I.recorderType2.code,this._opt.onInitSuccess(U({},I.recorderType2)))}},{key:"startCollect",value:function(e,t){if(this._isCanRun)return 1===this.status?(t&&t(U({},I.startCollectFailed)),!1):void(this.recordingType===I.recorderType1.code?this.openCamera(e,t):this._input.click())}},{key:"openCamera",value:function(r,e){var o=this;console.log("**********进入getUserMedia********"),o.getUserMedia({video:{width:o._opt.width,height:o._opt.height},audio:!1}).then(function(e){console.log("**********支持getUserMedia********"),o.status=1;var t=o._opt.el.getElementsByTagName("video")[0];"srcObject"in t?t.srcObject=e:t.src=window.URL.createObjectURL(e),console.log("stream=",e),o._mediaStreamTrack=e,console.log("self._opt.options=",o._opt.options),o._recorder=S(e,o._opt.options),o._recorder.startRecording(),0<o._opt.time&&(o._opt.countdownEl||o._showClock(o._canvas),o._clock=o._opt.time,o._clockTimer=setInterval(function(){o._clock--,console.log("self._clock===",o._clock),o._opt.countdownEl&&(o._opt.countdownEl.innerHTML=o._clock),o._clock<=0&&(clearInterval(o._clockTimer),o._clockTimer=null)},1e3),o._recorderTimer=setTimeout(function(){o.stopCollect()},1e3*o._opt.time)),r&&r(U({},I.openCameraSuccess))}).catch(function(e){console.log("getUserMedia--error=====",e),o._opt.onError&&o._opt.onError(U({},I.openCameraFailed)),o.status=0})}},{key:"openNativeCamera",value:function(){this._input.click()}},{key:"_showClock",value:function(e){var t=this,r=e.getContext("2d");this._clock&&(r.font="bold 24px Verdana",r.fillStyle="#fff",r.fillText(this._clock,10,34)),this._renderTimer=h(function(){r.clearRect(0,0,e.width,e.height),t._showClock(e)})}},{key:"stopCollect",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],r=this;if(0===this.status)return this._opt.onError(U({},I.needOpenCamera)),!1;console.log("stop11111111"),r._recorder?(clearInterval(r._clockTimer),clearTimeout(r._recorderTimer),g(r._renderTimer),r._canvas.getContext("2d").clearRect(0,0,r._canvas.width,r._canvas.height),r.status=0,r._recorder.stopRecording(function(e){r._blob=r._recorder.getBlob(),console.log("self.blob===",r._blob),t&&r._opt.onSuccess&&r._opt.onSuccess(U(U({},I.recordingEnd),{},{data:r._blob}))}),r._mediaStreamTrack&&r._mediaStreamTrack.getTracks().forEach(function(e){e.stop()})):r._opt.onError(U({},I.recorderEmpty))}},{key:"getBlobData",value:function(){return this._blob||(this._recorder?this._recorder.getBlob():(this._opt.onError&&this._opt.onError(U({},I.recorderEmpty)),!1))}},{key:"bytesToSize",value:function(){if(this._blob)return S.bytesToSize(this._blob.size)}},{key:"getRunEnvironment",value:function(){var e=navigator.userAgent.toLowerCase();console.log("str=",e,"navigator:",navigator,"navigator.userAgentData:",navigator.userAgentData);var t,r,o={isIos:!1,isAndroid:!1,version:"",phoneBrand:"",system:"",isWeixin:-1!=e.indexOf("micromessenger")};return o.phoneBrand=e.match(/\((.+?)\)/g)[0],/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)&&(t=e.match(/os (.*?) like mac os/),o.isIos=!0,o.system="iphone",t&&1<t.length?(r=t[1].replace(/_/g,".").split("."),o.version=Number(r[0])+.1*Number(r[1])):t&&1===t.length?(r=t[1].replace(/_/g,".").split("."),o.version=Number(r[0])):o.version="",console.log("你当前的Ios系统版本为："+o.version)),(-1<e.indexOf("android")||-1<e.indexOf("adr")||-1<e.indexOf("Android")||-1<e.indexOf("Adr"))&&(o.isAndroid=!0,o.system="android",r=null,0<e.indexOf("android")&&(r=(e.match(/android [\d._]+/gi)+"").replace(/[^0-9|_.]/gi,"").replace(/_/gi,"."),console.log("你当前的Android系统版本为："+r),r=parseInt(r.split(".")[0]),o.version=r)),o}},{key:"isSupportRecord",value:function(){console.log("this._runEnvironment=",this._runEnvironment,this._runEnvironment[0],"undefined"==typeof MediaRecorder?"undefined":$t(MediaRecorder));var e,t=[];for(e in q)q[e].isWeixin?-1<this._runEnvironment.phoneBrand.indexOf(q[e].phoneBrand)&&this._runEnvironment.system==q[e].system&&this._runEnvironment.version==q[e].version&&this._runEnvironment.isWeixin&&t.push(q[e]):-1<this._runEnvironment.phoneBrand.indexOf(q[e].phoneBrand)&&this._runEnvironment.system==q[e].system&&this._runEnvironment.version==q[e].version&&t.push(q[e]);return console.log("black list contain =",t),!(t[0]&&t[0].phoneBrand&&t[0].system&&t[0].version||this._runEnvironment.isAndroid&&this._runEnvironment.version<9||this._runEnvironment.isIos&&this._runEnvironment.version<=14&&"undefined"==typeof MediaRecorder||this._isIosWeixin&&1===this._opt.mode)}},{key:"isSupportUserMedia",value:function(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.getUserMedia)}},{key:"getUserMedia",value:function(e){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var t=navigator.mediaDevices.getSupportedConstraints();return console.log("supports=",t),t.width&&t.height?navigator.mediaDevices.getUserMedia(e):(console.log("!supports.width || !supports.height"),navigator.mediaDevices.getUserMedia({video:!0,audio:!1}))}return navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(e):navigator.mozGetUserMedia?navigator.mozGetUserMedia(e):navigator.getUserMedia?navigator.getUserMedia(e):(console.log("reject-----"),Promise.reject())}},{key:"jsPath",value:function(){var e=(e=document.getElementsByTagName("script"))[e.length-1].getAttribute("src");return alert(e),e&&e.replace(/[^[\/\\]+\.js$/i,"")}}])&&x(e.prototype,t),o&&x(e,o),r}()},"object"==("undefined"==typeof exports?"undefined":$t(exports))&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e=e||self).CWMediaCollector=r()});